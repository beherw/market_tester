const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ObtainMethods-GlTT2shJ.js","assets/services-data-DOFC0cEd.js","assets/opencc-C1Qz6KEM.js","assets/data-tw-items-4ChDDRSh.js","assets/data-tw-descriptions-CJIEoqIq.js","assets/react-vendor-DmEpS5Kz.js","assets/vendor-dPMYpV4t.js","assets/extractsService-D72l7IXV.js","assets/data-tw-other-De0qaQHL.js","assets/data-other-BAzrwk9S.js","assets/data-db-CylQINsK.js","assets/axios-B9ygI19o.js","assets/UltimatePriceKing-DvENx_BI.js","assets/internalUrl-BGvhBhUH.js","assets/MSQPriceChecker-dlZbV28U.js","assets/AdvancedSearch-C4imI9IK.js","assets/CraftingTree-wdkwG18M.js","assets/RelatedItems-BO8JHgY2.js","assets/HistorySection-CmNIxODY.js","assets/RecentUpdatesSection-Dr8KdBpc.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,u as Gr,a as vs,b as un,c as mn,d as Wr,R as fn,B as xn}from"./react-vendor-DmEpS5Kz.js";import{g as _s,_ as Te,h as Es,c as Br,s as Ms,a as Hr,f as hn,b as Ps}from"./services-data-DOFC0cEd.js";import{a as Zr}from"./axios-B9ygI19o.js";import"./vendor-dPMYpV4t.js";import"./opencc-C1Qz6KEM.js";import"./data-tw-items-4ChDDRSh.js";import"./data-tw-descriptions-CJIEoqIq.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))s(d);new MutationObserver(d=>{for(const i of d)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function o(d){const i={};return d.integrity&&(i.integrity=d.integrity),d.referrerPolicy&&(i.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?i.credentials="include":d.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(d){if(d.ep)return;d.ep=!0;const i=o(d);fetch(d.href,i)}})();const es="ffxiv_market_item_history",pn=10,hs=new Set;function gn(r){return hs.add(r),()=>hs.delete(r)}function bs(){const r=Gt();hs.forEach(n=>n(r))}function Gt(){try{const r=localStorage.getItem(es);if(!r)return[];const n=JSON.parse(r);return Array.isArray(n)?n:[]}catch(r){return console.error("Failed to get item history:",r),[]}}function us(r){try{let n=Gt();n=n.filter(o=>o!==r),n.unshift(r),n=n.slice(0,pn),localStorage.setItem(es,JSON.stringify(n)),bs()}catch(n){console.error("Failed to add item to history:",n)}}function vn(r){try{let n=Gt();n=n.filter(o=>o!==r),localStorage.setItem(es,JSON.stringify(n)),bs()}catch(n){console.error("Failed to remove item from history:",n)}}function bn(){try{localStorage.removeItem(es),bs()}catch(r){console.error("Failed to clear item history:",r)}}function ws(){const[r,n]=t.useState([]),[o,s]=t.useState(()=>Gt()),[d,i]=t.useState(!1),h=t.useRef(!1),c=t.useRef("");t.useEffect(()=>{const L=gn(I=>{s(I)}),u=I=>{I.key==="ffxiv_market_item_history"&&s(Gt())};return window.addEventListener("storage",u),()=>{L(),window.removeEventListener("storage",u)}},[]),t.useEffect(()=>{const R=JSON.stringify(o);if(c.current===R||h.current)return;(async()=>{if(o.length===0){n([]),c.current=R;return}h.current=!0,i(!0);try{const I=(await Promise.all(o.map(async f=>{try{return await _s(f)}catch(O){return console.error(`Failed to load item ${f}:`,O),null}}))).filter(f=>f!==null);n(I),c.current=R}catch(u){console.error("Failed to load history items:",u),n([])}finally{h.current=!1,i(!1)}})()},[o]);const b=t.useCallback(()=>{bn(),n([]),s([]),c.current="[]"},[]),p=t.useCallback(()=>{const R=Gt();s(R),c.current=""},[]);return{historyItems:r,historyIds:o,isLoading:d,clearHistory:b,refreshHistory:p,hasHistory:o.length>0}}const js="ffxiv_market_search_history",wn=10;function jr(){try{const r=localStorage.getItem(js);if(!r)return[];const n=JSON.parse(r);return Array.isArray(n)?n:[]}catch(r){return console.error("Failed to get search history:",r),[]}}function jn(r){try{if(!r||!r.trim())return;const n=r.trim();let o=jr();o=o.filter(s=>s!==n),o.unshift(n),o=o.slice(0,wn),localStorage.setItem(js,JSON.stringify(o))}catch(n){console.error("Failed to add search to history:",n)}}function yn(r){try{let n=jr();n=n.filter(o=>o!==r),localStorage.setItem(js,JSON.stringify(n)),window.dispatchEvent(new Event("searchHistoryChanged"))}catch(n){console.error("Failed to remove search from history:",n)}}const Pt=new Map,Jt=new Map,yr=new Map;class Nn{constructor(){this.queue=[],this.processing=!1,this.isPaused=!1,this.pauseUntil=0,this.MAX_REQUESTS_PER_SECOND=19,this.MIN_DELAY_MS=53,this.requestTimestamps=[],this.RATE_LIMIT_RETRY_DELAY=2e3,this.MAX_RETRY_DELAY=1e4}getDelayBeforeNextRequest(){const n=Date.now(),o=n-1e3;if(this.requestTimestamps=this.requestTimestamps.filter(i=>i>o),this.requestTimestamps.length<this.MAX_REQUESTS_PER_SECOND)return 0;const d=this.requestTimestamps[0]+1e3-n;return Math.max(d+10,this.MIN_DELAY_MS)}recordRequest(){this.requestTimestamps.push(Date.now())}async enqueue(n,o,s=null){return new Promise((d,i)=>{this.queue.push({itemId:n,requestFn:o,resolve:d,reject:i,retryCount:0,abortSignal:s}),this.processing||this.processQueue()})}async processItem(n){try{if(n.abortSignal&&n.abortSignal.aborted){n.reject(new Error("Request cancelled"));return}const o=this.getDelayBeforeNextRequest();if(o>0&&await new Promise(d=>setTimeout(d,o)),n.abortSignal&&n.abortSignal.aborted){n.reject(new Error("Request cancelled"));return}this.recordRequest();const s=await n.requestFn();n.resolve(s)}catch(o){if(o.name==="AbortError"||n.abortSignal&&n.abortSignal.aborted){n.reject(new Error("Request cancelled"));return}if(o.status===429||o.response&&o.response.status===429){const s=Math.min(this.RATE_LIMIT_RETRY_DELAY*Math.pow(2,n.retryCount),this.MAX_RETRY_DELAY);this.isPaused=!0,this.pauseUntil=Date.now()+s,this.requestTimestamps=[],n.retryCount++,n.retryCount<5?this.queue.unshift(n):n.reject(new Error("Rate limit exceeded. Please try again later."))}else n.resolve(null)}finally{this.processQueue()}}async processQueue(){if(this.queue.length===0){this.processing=!1;return}const n=Date.now();if(this.isPaused&&n<this.pauseUntil){const o=this.pauseUntil-n;await new Promise(s=>setTimeout(s,o)),this.isPaused=!1,this.pauseUntil=0}if(this.queue.length>0){this.processing=!0;const o=this.queue.shift();await this.processItem(o)}}reset(){this.requestTimestamps=[]}clear(){this.queue.forEach(n=>{n.reject&&n.reject(new Error("Request queue cleared"))}),this.queue=[],this.processing=!1}}const As=new Nn;function kn(r){const n=r.toString().padStart(6,"0");return["020000","021000","022000","023000","024000"].map(s=>`https://xivapi.com/i/${s}/${n}.png`)}async function Sn(r,n=null){if(n&&n.aborted)throw new Error("Request cancelled");const o=new AbortController,s=setTimeout(()=>o.abort(),5e3);n&&n.addEventListener("abort",()=>{o.abort(),clearTimeout(s)});const d=o.signal;try{const i=await fetch(`https://xivapi.com/Item/${r}?columns=Icon`,{signal:d});if(clearTimeout(s),!i.ok){if(i.status===404)return Pt.set(r,null),null;if(i.status===429){const c=new Error("Rate limit exceeded");throw c.status=429,c.response={status:429},c}return Pt.set(r,null),null}const h=await i.json();if(h&&h.Icon){const c=`https://xivapi.com${h.Icon}`;return Pt.set(r,c),c}return Pt.set(r,null),null}catch(i){if(i.status===429||i.response&&i.response.status===429)throw i;if(i.name==="AbortError"||n&&n.aborted)throw new Error("Request cancelled");return Pt.set(r,null),null}}async function Cn(r,n=null){if(!r||r<=0||n&&n.aborted)return null;if(Pt.has(r))return Pt.get(r);if(Jt.has(r)){const i=Jt.get(r);return n&&n.aborted?null:await i}let o=null,s=n;s||(o=new AbortController,s=o.signal,yr.set(r,o));const d=As.enqueue(r,()=>Sn(r,s),s).then(i=>(Jt.delete(r),yr.delete(r),i)).catch(i=>(Jt.delete(r),yr.delete(r),i.message==="Request cancelled"||s&&s.aborted,null));return Jt.set(r,d),await d}function Rn(r){return!r||r<=0?null:Pt.get(r)||null}function Ln(r){return!r||r<=0?[]:kn(r)}function ms(){yr.forEach((r,n)=>{r.abort()}),yr.clear(),As.clear(),Jt.clear()}function ts({itemId:r,alt:n,className:o,priority:s=!1,loadDelay:d=0,...i}){const[h,c]=t.useState(null),[b,p]=t.useState(!0),[R,L]=t.useState(!1),[u,I]=t.useState([]),[f,O]=t.useState(0),[g,te]=t.useState(s),w=t.useRef(null);t.useRef(null);const m=t.useRef(null),y=t.useRef(null),E=t.useRef(null);t.useEffect(()=>{if(s){te(!0);return}return d>0&&d<=750?(w.current=setTimeout(()=>{te(!0)},d),()=>{w.current&&clearTimeout(w.current)}):(typeof IntersectionObserver<"u"?(m.current&&m.current.disconnect(),m.current=new IntersectionObserver($=>{$.forEach(ce=>{ce.isIntersecting&&(te(!0),m.current&&y.current&&m.current.unobserve(y.current))})},{rootMargin:"50px",threshold:.01})):w.current=setTimeout(()=>{te(!0)},1e3),()=>{w.current&&clearTimeout(w.current),m.current&&m.current.disconnect()})},[s,d]),t.useEffect(()=>{if(!g||!r||r<=0){(!r||r<=0)&&(p(!1),L(!0));return}const ue=Rn(r);if(ue){c(ue),p(!1),L(!1);return}E.current=new AbortController;const $=E.current.signal,ce=Ln(r);return I(ce),p(!0),Cn(r,$).then(re=>{$.aborted||(re?(c(re),L(!1)):ce.length>0?(c(ce[0]),O(0)):L(!0),p(!1))}).catch(re=>{re.message==="Request cancelled"||$.aborted||(console.error("Failed to load item image:",re),ce.length>0?(c(ce[0]),O(0)):L(!0),p(!1))}),()=>{E.current&&(E.current.abort(),E.current=null)}},[r,g]);const X=()=>{if(f<u.length-1){const ue=f+1;O(ue),c(u[ue])}else L(!0),c(null)},S=()=>{if(!o)return{width:"w-10",height:"h-10"};const ue=o.match(/\bw-(\d+)\b/),$=o.match(/\bh-(\d+)\b/),ce=ue?`w-${ue[1]}`:"w-10",re=$?`h-${$[1]}`:"h-10";return{width:ce,height:re}},{width:z,height:H}=S(),de=o?.split(" ").filter(ue=>!ue.match(/^(w-|h-)/)).join(" ")||"",ge=`${z} ${H} bg-purple-900/40 rounded border border-purple-500/30 flex items-center justify-center flex-shrink-0 ${de}`.trim();return t.useEffect(()=>{if(!s&&(d===0||d>750)&&m.current&&y.current)return m.current.observe(y.current),()=>{m.current&&y.current&&m.current.unobserve(y.current)}},[s,d]),g?b||R&&!h?e.jsx("div",{ref:y,className:ge,children:b?e.jsx("span",{className:"text-xs text-gray-500 animate-pulse",children:"..."}):e.jsx("span",{className:"text-xs text-gray-500",children:"?"})}):h?e.jsx("div",{ref:y,className:ge,children:e.jsx("img",{src:h,alt:n||`Item ${r}`,className:"w-full h-full object-contain",onError:X,"data-item-id":r,...i})}):e.jsx("div",{ref:y,className:ge,children:e.jsx("span",{className:"text-xs text-gray-500",children:"?"})}):e.jsx("div",{ref:y,className:ge,children:e.jsx("span",{className:"text-xs text-gray-500 opacity-50",children:"..."})})}function ps({onSearch:r,isLoading:n,value:o,onChange:s,disabled:d,disabledTooltip:i,selectedDcName:h,onItemSelect:c,searchResults:b=[],marketableItems:p=null}){const[R,L]=t.useState(o||""),[u,I]=t.useState(!1),[f,O]=t.useState(!1),[g,te]=t.useState([]),[w,m]=t.useState(!1);t.useRef(null);const y=t.useRef(r),E=t.useRef(null),X=t.useRef(null),S=t.useRef(null),{historyItems:z}=ws(),H=b&&b.length>0;t.useEffect(()=>{y.current=r},[r]),t.useEffect(()=>{if(f&&!R.trim()){const C=jr();te(C)}},[f,R]),t.useEffect(()=>{const C=K=>{if(K.key==="ffxiv_market_search_history"){const se=jr();te(se)}};window.addEventListener("storage",C);const Y=()=>{const K=jr();te(K)};return window.addEventListener("searchHistoryChanged",Y),()=>{window.removeEventListener("storage",C),window.removeEventListener("searchHistoryChanged",Y)}},[]),t.useEffect(()=>()=>{S.current&&clearTimeout(S.current)},[]);const de=()=>{m(!0),d||O(!0)},ge=C=>{S.current&&(clearTimeout(S.current),S.current=null);const Y=C.relatedTarget;if(Y&&Y.closest&&Y.closest("[data-prompt-clickable]"))return;if(X.current&&X.current.contains(Y)){m(!1);return}const K=document.activeElement;if(X.current&&X.current.contains(K)){m(!1);return}S.current=setTimeout(()=>{m(!1),S.current=null},150)},ue=()=>{if(!H||!R.trim())return[];const C=R.trim(),Y=C.toLowerCase(),K=new Set,se=new Set;(p?b.filter(ve=>p.has(ve.id)):b).forEach(ve=>{if(ve.name){const Ie=ve.name,Nt=Ie.toLowerCase();let ct=0;for(;(ct=Nt.indexOf(Y,ct))!==-1;){const Re=ct,fe=ct+C.length;if(Re>0){const dt=Ie[Re-1];if(/[\u4e00-\u9fa5]/.test(dt)){const $e=Ie.substring(Re-1,fe);$e.length>=2&&$e.length<=3&&K.add($e)}}if(fe<Ie.length){const dt=Ie[fe];if(/[\u4e00-\u9fa5]/.test(dt)){const $e=Ie.substring(Re,fe+1);$e.length>=2&&$e.length<=3&&se.add($e)}}ct=fe}}});const Tt=new Set([...K,...se]),qe=Array.from(Tt).sort((ve,Ie)=>ve.length!==Ie.length?ve.length-Ie.length:ve.localeCompare(Ie,"zh-CN"));return qe.length<=50?qe:qe.slice(0,50)},$=C=>{S.current&&(clearTimeout(S.current),S.current=null),m(!1),O(!1),L(C),s&&s(C),r&&r(C)};t.useEffect(()=>{const C=Y=>{X.current&&!X.current.contains(Y.target)&&E.current&&!E.current.contains(Y.target)&&O(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]),t.useEffect(()=>{R.trim()&&!H&&O(!1)},[R,H]);const ce=C=>{S.current&&(clearTimeout(S.current),S.current=null),m(!1),O(!1),c&&c(C)},re=C=>{S.current&&(clearTimeout(S.current),S.current=null),m(!1),O(!1),L(C),s&&s(C),r&&r(C)},Ze=(C,Y)=>{C.stopPropagation(),vn(Y)},Zt=(C,Y)=>{C.stopPropagation(),yn(Y),te(K=>K.filter(se=>se!==Y))};t.useEffect(()=>{o!==void 0&&o!==R&&L(o)},[o]);const Ye=C=>{const Y=C.target.value;L(Y),s&&s(Y),H&&O(!0)},Xe=C=>{C.key==="Enter"&&!u&&!me&&(R.trim()?y.current(R.trim()):y.current(""))},me=d||n;return e.jsx("div",{className:"w-full h-full",children:e.jsxs("div",{className:"relative group h-full",children:[e.jsx("div",{className:"absolute left-2.5 mid:left-3 top-1/2 transform -translate-y-1/2 text-gray-400 z-10",children:e.jsx("svg",{className:"w-4 h-4 mid:w-5 mid:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{ref:E,type:"text",value:R,onChange:Ye,onKeyDown:Xe,onFocus:de,onBlur:ge,onCompositionStart:()=>I(!0),onCompositionEnd:()=>I(!1),placeholder:"多關鍵詞用空格分隔（例：豹 褲）",className:`w-full h-full pl-9 mid:pl-10 ${R.trim()&&!n?"pr-20 mid:pr-24":"pr-9 mid:pr-10"} bg-slate-900/80 backdrop-blur-sm border rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-1 transition-all text-xs mid:text-sm shadow-lg ${me?"border-slate-700/30 cursor-not-allowed opacity-60":"border-purple-500/30 focus:border-ffxiv-gold focus:ring-ffxiv-gold/50"}`,disabled:me}),n&&e.jsx("div",{className:"absolute right-2.5 mid:right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-3.5 w-3.5 mid:h-4 mid:w-4 border-b-2 border-ffxiv-gold"})}),R.trim()&&!n&&!me&&w&&e.jsxs("div",{"data-prompt-clickable":!0,onMouseDown:C=>{C.preventDefault()},onClick:()=>{R.trim()?y.current(R.trim()):y.current("")},className:"absolute right-2.5 mid:right-3 top-1/2 transform -translate-y-1/2 text-xs mid:text-sm flex items-center gap-1 cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx("span",{className:"hidden mid:inline search-prompt-flow","data-text":"按 Enter 搜索",children:"按 Enter 搜索"}),e.jsx("span",{className:"mid:hidden search-prompt-flow","data-text":"Enter",children:"Enter"}),e.jsx("svg",{className:"w-3 h-3 mid:w-3.5 mid:h-3.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),d&&i&&e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-slate-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 border border-slate-700",children:[i,e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-0",children:e.jsx("div",{className:"border-4 border-transparent border-b-slate-900"})})]}),f&&e.jsx("div",{ref:X,className:"absolute top-full left-0 right-0 mt-1 bg-slate-900/95 backdrop-blur-sm border border-purple-500/30 rounded-lg shadow-xl z-50 max-h-80 overflow-y-auto",children:H&&R.trim()?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 border-b border-slate-700/50",children:e.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"關鍵字推薦"})}),e.jsxs("div",{className:"py-1",children:[ue().map((C,Y)=>e.jsxs("button",{onClick:()=>$(C),className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-purple-800/40 transition-colors text-left group",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-sm text-white truncate",children:C})})]},`${C}-${Y}`)),ue().length===0&&e.jsx("div",{className:"py-4 text-center text-xs text-gray-500",children:"無匹配關鍵字"})]})]}):e.jsxs(e.Fragment,{children:[g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-2 border-b border-slate-700/50",children:e.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"搜索關鍵字"})}),e.jsx("div",{className:"py-1",children:g.slice(0,3).map((C,Y)=>e.jsxs("div",{onClick:()=>re(C),onKeyDown:K=>{(K.key==="Enter"||K.key===" ")&&(K.preventDefault(),re(C))},role:"button",tabIndex:0,className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-purple-800/40 transition-colors text-left group cursor-pointer",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"text-sm text-white truncate",children:C})}),e.jsx("button",{onClick:K=>Zt(K,C),className:"flex-shrink-0 p-1 text-gray-400 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",title:"刪除",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${C}-${Y}`))})]}),z.length>0&&e.jsxs(e.Fragment,{children:[g.length>0&&e.jsx("div",{className:"px-3 py-2 border-t border-b border-slate-700/50",children:e.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"歷史記錄"})}),g.length===0&&e.jsx("div",{className:"px-3 py-2 border-b border-slate-700/50",children:e.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"歷史記錄"})}),e.jsx("div",{className:"py-1",children:z.slice(0,5).map(C=>e.jsxs("div",{onClick:()=>ce(C),onKeyDown:Y=>{(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),ce(C))},role:"button",tabIndex:0,className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-purple-800/40 transition-colors text-left group cursor-pointer",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-ffxiv-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx(ts,{itemId:C.id,alt:C.name,className:"w-8 h-8 object-contain rounded border border-slate-600/50 bg-slate-800/50 flex-shrink-0"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white truncate",children:C.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",C.id]})]}),e.jsx("button",{onClick:Y=>Ze(Y,C.id),className:"flex-shrink-0 p-1 text-gray-400 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",title:"刪除",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},C.id))})]}),z.length===0&&g.length===0&&e.jsx("div",{className:"py-4 text-center text-xs text-gray-500",children:"暫無記錄"})]})})]})})}function fs({datacenters:r,worlds:n,selectedWorld:o,onWorldChange:s,selectedServerOption:d,onServerOptionChange:i,serverOptions:h,disabled:c=!1}){r?.filter(p=>p.region&&p.region.startsWith("繁中服"));const b=o?.dcObj?.worlds||[];return e.jsxs("div",{className:"flex items-center gap-1.5 mid:gap-2 detail:gap-3 w-full detail:w-auto relative z-10 group",children:[o&&b.length>0&&e.jsxs("div",{className:"flex gap-1 mid:gap-1.5 detail:gap-2 flex-wrap w-full detail:w-auto relative pl-1",children:[e.jsxs("button",{onClick:()=>!c&&i(o.section),disabled:c,className:`relative z-10 px-2 mid:px-3 detail:px-4 py-1 mid:py-1.5 detail:py-2 rounded-lg text-xs font-medium transition-all border whitespace-nowrap hover:!translate-y-0 ${c?"bg-slate-700/30 border-slate-600/20 text-gray-600 cursor-not-allowed opacity-50":d===o.section?"bg-gradient-to-r from-ffxiv-gold/30 to-ffxiv-gold/20 border-ffxiv-gold text-ffxiv-gold shadow-[0_0_10px_rgba(212,175,55,0.3)]":"bg-purple-800/50 border-purple-500/40 text-gray-300 hover:border-purple-400/60 hover:bg-purple-700/60"}`,children:[e.jsxs("span",{className:"hidden detail:inline",children:[o.section,"（全服搜尋）"]}),e.jsxs("span",{className:"hidden mid:inline detail:hidden",children:[o.section,"（全服）"]}),e.jsx("span",{className:"mid:hidden",children:"全服"})]}),b.map(p=>{const R=n[p],L=d===p;return e.jsx("button",{onClick:()=>!c&&i(p),disabled:c,className:`relative z-10 px-2 mid:px-3 detail:px-4 py-1 mid:py-1.5 detail:py-2 rounded-lg text-xs font-medium transition-all border whitespace-nowrap hover:!translate-y-0 ${c?"bg-slate-700/30 border-slate-600/20 text-gray-600 cursor-not-allowed opacity-50":L?"bg-gradient-to-r from-ffxiv-gold/30 to-ffxiv-gold/20 border-ffxiv-gold text-ffxiv-gold shadow-[0_0_10px_rgba(212,175,55,0.3)]":"bg-purple-800/50 border-purple-500/40 text-gray-300 hover:border-purple-400/60 hover:bg-purple-700/60"}`,children:R},p)})]}),c&&e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-slate-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 border border-slate-700",children:["請耐心等待物品加載完成",e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-0",children:e.jsx("div",{className:"border-4 border-transparent border-b-slate-900"})})]})]})}function In({isOpen:r,onClose:n,taxRates:o,worlds:s,isLoading:d,selectedWorld:i,selectedServerOption:h,onServerOptionChange:c}){if(t.useEffect(()=>{const u=I=>{I.key==="Escape"&&r&&n()};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[r,n]),!r)return null;if(!i||!i.dcObj)return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:n,children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900 via-purple-900/30 to-slate-900 rounded-lg border-2 border-purple-500/50 shadow-2xl max-w-md w-full p-6",onClick:u=>u.stopPropagation(),children:[e.jsx("p",{className:"text-gray-400 text-center",children:"請先選擇伺服器"}),e.jsx("button",{onClick:n,className:"mt-4 w-full px-4 py-2 bg-purple-800/50 hover:bg-purple-700/70 rounded-lg text-white transition-all",children:"關閉"})]})]});const b=i.dcObj.worlds||[],p=Object.keys(o).length>0,R=h&&h!==i.section&&typeof h=="number",L={LimsaLominsa:"利姆薩·羅敏薩",Gridania:"格里達尼亞","Ul'dah":"烏爾達哈",Ishgard:"伊修加德",Kugane:"黃金港",Crystarium:"水晶都",OldSharlayan:"舊薩雷安"};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:n,children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900 via-purple-900/30 to-slate-900 rounded-lg border-2 border-purple-500/50 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["市場稅率 - ",i.section]})]}),e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-white hover:bg-purple-800/40 rounded-lg transition-all",title:"關閉",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-ffxiv-gold"}),e.jsx("span",{className:"text-lg text-gray-300",children:"載入市場稅率..."})]})}):p?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(u=>{const I=s[u],f=o[u];if(!f||!I)return null;const O=R&&h===u,g=Object.values(f).filter(m=>m!=null).map(m=>Number(m)).sort((m,y)=>m-y),te=g.length>0?g[0]:null,w=g.length>1?g[1]:null;return e.jsx("div",{onClick:()=>c&&c(u),className:`relative p-4 rounded-lg border transition-all cursor-pointer ${O?"server-box-rotating-light bg-gradient-to-br from-ffxiv-gold/20 via-yellow-500/15 to-ffxiv-gold/20 border-ffxiv-gold/50 shadow-lg shadow-ffxiv-gold/20":"bg-slate-900/40 border-purple-500/20 hover:bg-slate-800/60 hover:border-purple-400/40"}`,children:e.jsxs("div",{className:"relative z-[2]",children:[e.jsx("div",{className:"font-semibold text-sm mb-3 flex items-center gap-2 text-ffxiv-gold",children:I}),e.jsx("div",{className:"space-y-2 text-xs",children:Object.entries(L).map(([m,y])=>{const E=f[m];return E==null?null:{key:m,name:y,tax:Number(E)}}).filter(m=>m!==null).sort((m,y)=>y.tax-m.tax).map(({key:m,name:y,tax:E})=>{const X=E===te,S=E===w&&!X;return e.jsxs("div",{className:`flex justify-between items-center ${O?"text-gray-200":"text-gray-300"}`,children:[e.jsxs("span",{children:[y,":"]}),e.jsxs("span",{className:`font-medium ${X?"text-green-400 font-bold text-sm":S?"text-green-300 font-semibold":"text-ffxiv-gold"}`,children:[E,"%"]})]},m)})})]})},u)})}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"暫無稅率資料"})})})]})]})}let Vr=null;const En=async()=>Vr||(Vr=(await Te(()=>import("./data-other-BAzrwk9S.js").then(n=>n.c),[])).default,Vr);let zr=null;const Mn=async()=>zr||(zr=(await Te(()=>import("./data-other-BAzrwk9S.js").then(n=>n.r),[])).default,zr);let Ur=null;const Pn=async()=>Ur||(Ur=(await Te(()=>import("./data-other-BAzrwk9S.js").then(n=>n.d),[])).default,Ur);let Kr=null;const Tn=async()=>Kr||(Kr=(await Te(()=>import("./data-other-BAzrwk9S.js").then(n=>n.g),[])).default,Kr),Qr=["#4A90E2","#7B68EE","#FF6B6B","#FFD93D","#6BCF7F","#FF8C42","#9B59B6","#1ABC9C","#E74C3C","#3498DB","#F39C12","#16A085","#E67E22","#C0392B","#8E44AD","#27AE60","#2980B9","#D35400","#34495E","#95A5A6"],Ts=r=>{if(!r)return"#9CA3AF";const o=parseInt(r.split(".")[0],10)-2;return o>=0&&o<Qr.length?Qr[o]:o>=0?Qr[o%Qr.length]:"#9CA3AF"},qn=({itemName:r,addToast:n})=>{const o=s=>{s.stopPropagation(),navigator.clipboard.writeText(r).then(()=>{n&&n("已複製物品名稱","success")}).catch(()=>{n&&n("複製失敗","error")})};return e.jsx("td",{className:"px-2 sm:px-4 py-2 text-white font-medium text-xs sm:text-sm break-words",style:{minWidth:"160px",maxWidth:"280px"},children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"flex-1 block",style:{wordBreak:"break-word",lineHeight:"1.4"},children:r}),e.jsx("button",{onClick:o,className:"flex-shrink-0 p-1 text-gray-400 hover:text-ffxiv-gold hover:bg-purple-800/40 rounded-md border border-transparent hover:border-purple-500/40 transition-all duration-200",title:"複製物品名稱","aria-label":"複製物品名稱",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})};function qs({items:r,onSelect:n,selectedItem:o,marketableItems:s,itemVelocities:d,itemAveragePrices:i,itemMinListings:h,itemRecentPurchases:c,itemTradability:b,isLoadingVelocities:p,getSimplifiedChineseName:R,addToast:L,currentPage:u=1,itemsPerPage:I=null,selectedRarities:f,setSelectedRarities:O,raritiesData:g,externalRarityFilter:te=!1,externalRarityCounts:w=null,isServerDataLoaded:m=!0,isRaritySelectorDisabled:y=!1}){const[E,X]=t.useState("id"),[S,z]=t.useState("desc"),[H,de]=t.useState(null),[ge,ue]=t.useState(null),[$,ce]=t.useState(null),[re,Ze]=t.useState(null),[Zt,Ye]=t.useState([]),[Xe,me]=t.useState([]),C=f!==void 0?f:Zt,Y=O!==void 0?O:Ye,K=g||ge;t.useEffect(()=>{En().then(l=>{de(l)})},[]),t.useEffect(()=>{g==null&&!ge&&Mn().then(l=>{ue(l)})},[g]),t.useEffect(()=>{Promise.all([Pn(),Tn()]).then(([l,N])=>{ce(l),Ze(N)})},[]);const se=l=>!H||!l?null:H[l.toString()]||null;t.useCallback(l=>!K||!l?0:K[l.toString()]!==void 0?K[l.toString()]:0,[K]);const er=l=>{if(!$||!re||!l)return null;const N=$[l.toString()];if(N==null)return null;const T=re[N.toString()];if(!T||!T.version)return null;const q=parseFloat(T.version);return isNaN(q)?T.version:(Math.floor(q*10)/10).toFixed(1)},Tt=({version:l})=>{if(l==null)return e.jsx("span",{className:"text-gray-500 text-xs",children:"-"});const N=l,T=Ts(N);return e.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded-lg border transition-all hover:scale-105 shadow-sm",style:{background:`linear-gradient(135deg, ${T}20 0%, ${T}10 100%)`,borderColor:`${T}50`,color:T,boxShadow:`0 1px 3px ${T}20`},title:`版本 ${N}`,children:e.jsx("span",{className:"text-xs font-bold whitespace-nowrap tracking-tight",children:N})})},qe=t.useMemo(()=>{let l=r;if(s&&r.some(T=>s.has(T.id))&&(l=r.filter(T=>s.has(T.id))),!te&&C.length>0&&K&&(l=l.filter(N=>{const T=K[N.id?.toString()]!==void 0?K[N.id.toString()]:0;return C.includes(T)})),Xe.length>0&&$&&re){const N=Xe.map(T=>parseInt(T.split(".")[0],10)).filter(T=>!isNaN(T));N.length>0&&(l=l.filter(T=>{const q=er(T.id);if(!q)return!1;const G=parseFloat(q);if(isNaN(G))return!1;const ne=Math.floor(G);return N.includes(ne)}))}return l},[r,p,b,s,C,K,te,Xe,$,re]),ve=t.useMemo(()=>E?[...qe].sort((l,N)=>{const T=b?b[l.id]:void 0,q=b?b[N.id]:void 0,G=T===!0,ne=q===!0;if(E!=="tradable"&&G!==ne)return ne?1:-1;let J,Z;switch(E){case"id":const _e=H&&H[l.id?.toString()]||null,xe=H&&H[N.id?.toString()]||null;_e!==null&&xe!==null?(J=_e,Z=xe):_e!==null?(J=_e,Z=N.id):xe!==null?(J=l.id,Z=xe):(J=l.id,Z=N.id);break;case"name":J=l.name||"",Z=N.name||"";break;case"tradable":J=T===!0?1:0,Z=q===!0?1:0;break;case"velocity":const Se=d?d[l.id]:null,Ce=d?d[N.id]:null;J=Se??null,Z=Ce??null;break;case"averagePrice":const be=i?i[l.id]:null,Oe=i?i[N.id]:null;J=be??null,Z=Oe??null;break;case"minListing":const Ae=h?h[l.id]:null,Ee=h?h[N.id]:null;J=Ae!=null?typeof Ae=="object"?Ae.price:Ae:null,Z=Ee!=null?typeof Ee=="object"?Ee.price:Ee:null;break;case"recentPurchase":const qt=c?c[l.id]:null,ut=c?c[N.id]:null;J=qt!=null?typeof qt=="object"?qt.price:qt:null,Z=ut!=null?typeof ut=="object"?ut.price:ut:null;break;default:return 0}if(E==="velocity"||E==="averagePrice"||E==="minListing"||E==="recentPurchase"){if(G&&ne){const _e=J!=null,xe=Z!=null;if(_e!==xe)return xe?1:-1;if(_e&&xe){if(J<Z)return S==="asc"?1:-1;if(J>Z)return S==="asc"?-1:1}}}else if(E==="tradable"){if(J<Z)return S==="asc"?1:-1;if(J>Z)return S==="asc"?-1:1}else{if(J<Z)return S==="asc"?-1:1;if(J>Z)return S==="asc"?1:-1}return l.id-N.id}):qe,[qe,E,S,b,d,i,h,c,H]),Ie=t.useMemo(()=>{if(!I||I<=0)return ve;const l=(u-1)*I,N=l+I;return ve.slice(l,N)},[ve,u,I]),Nt=t.useMemo(()=>{if(ve.length<=5)return!1;const l=ve[0];return l&&b?.[l.id]===!1},[ve,b]),ct=t.useMemo(()=>ve.filter(N=>i?.[N.id]!==void 0).length>10,[ve,i]),Re=l=>{E===l?z(S==="asc"?"desc":"asc"):(X(l),z("asc"))},fe=({column:l})=>E!==l?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):S==="asc"?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})});if(!r||r.length===0)return null;const dt=t.useMemo(()=>{if(w)return w;if(!K)return{};const l={};return r.forEach(N=>{const T=K[N.id?.toString()]!==void 0?K[N.id.toString()]:0;l[T]=(l[T]||0)+1}),l},[r,K,w]),$e=t.useMemo(()=>{if(!$||!re||!r||r.length===0)return{};const l={};return r.forEach(N=>{if(!$||!re||!N.id)return;const T=$[N.id.toString()];if(T==null)return;const q=re[T.toString()];if(!q||!q.version)return;const G=parseFloat(q.version);if(isNaN(G))return;const J=`${Math.floor(G)}.X`;l[J]=(l[J]||0)+1}),l},[r,$,re]),kt=t.useMemo(()=>Object.keys($e).sort((N,T)=>{const q=parseInt(N.split(".")[0],10),G=parseInt(T.split(".")[0],10);return isNaN(q)||isNaN(G)?N.localeCompare(T):G-q}),[$e]),Nr=t.useMemo(()=>{if(!K||!r||r.length===0)return{};let l=r;if(Xe.length>0&&$&&re){const T=Xe.map(q=>parseInt(q.split(".")[0],10)).filter(q=>!isNaN(q));T.length>0&&(l=r.filter(q=>{if(!$||!re||!q.id)return!1;const G=$[q.id.toString()];if(G==null)return!1;const ne=re[G.toString()];if(!ne||!ne.version)return!1;const J=parseFloat(ne.version);if(isNaN(J))return!1;const Z=Math.floor(J);return T.includes(Z)}))}const N={};return l.forEach(T=>{const q=K[T.id?.toString()]!==void 0?K[T.id.toString()]:0;N[q]=(N[q]||0)+1}),N},[r,K,Xe,$,re]),Ot=t.useMemo(()=>{if(!$||!re||!r||r.length===0)return{};let l=r;C.length>0&&K&&(l=r.filter(T=>{const q=K[T.id?.toString()]!==void 0?K[T.id.toString()]:0;return C.includes(q)}));const N={};return l.forEach(T=>{if(!$||!re||!T.id)return;const q=$[T.id.toString()];if(q==null)return;const G=re[q.toString()];if(!G||!G.version)return;const ne=parseFloat(G.version);if(isNaN(ne))return;const Z=`${Math.floor(ne)}.X`;N[Z]=(N[Z]||0)+1}),N},[r,$,re,C,K]),Wt=[{value:1,label:"普通",color:"#f3f3f3"},{value:2,label:"精良",color:"#c0ffc0"},{value:3,label:"稀有",color:"#5990ff"},{value:4,label:"史诗",color:"#b38cff"}];return e.jsxs("div",{className:"overflow-x-auto bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20",children:[(K||kt.length>0&&$&&re)&&e.jsx("div",{className:"px-4 py-2 bg-purple-900/20 border-b border-purple-500/20",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[K&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs font-semibold text-ffxiv-gold",children:"稀有度選擇:"}),Wt.map(l=>{const N=C.includes(l.value),q=(Xe.length>0?Nr[l.value]||0:dt[l.value]||0)===0||y;return e.jsx("button",{type:"button",onClick:()=>{Y(N?G=>G.filter(ne=>ne!==l.value):G=>[...G,l.value])},disabled:q,className:`px-2 py-1 rounded-md text-xs font-medium transition-all border ${q?"border-gray-700 bg-slate-800/30 text-gray-600 cursor-not-allowed opacity-30":N?"border-ffxiv-gold bg-ffxiv-gold/20 text-ffxiv-gold":"border-gray-600 bg-slate-800/50 text-gray-400 hover:border-gray-500 hover:bg-slate-700/50 opacity-60"}`,style:{borderColor:q||N?void 0:l.color,color:q||N?void 0:l.color},title:q?y?"請耐心等待物品加載完成":`${l.label} (無物品)`:l.label,children:e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:l.color}}),e.jsx("span",{children:l.label})]})},l.value)})]}),kt.length>0&&$&&re&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs font-semibold text-ffxiv-gold ml-2",children:"版本號選擇:"}),kt.map(l=>{const N=Xe.includes(l),q=(C.length>0?Ot[l]||0:$e[l]||0)===0||y,G=Ts(l);return e.jsx("button",{type:"button",onClick:()=>{me(N?ne=>ne.filter(J=>J!==l):ne=>[...ne,l])},disabled:q,className:`px-2 py-1 rounded-md text-xs font-medium transition-all border ${q?"border-gray-700 bg-slate-800/30 text-gray-600 cursor-not-allowed opacity-30":N?"border-ffxiv-gold bg-ffxiv-gold/20 text-ffxiv-gold":"border-gray-600 bg-slate-800/50 text-gray-400 hover:border-gray-500 hover:bg-slate-700/50 opacity-60"}`,style:{borderColor:q||N?void 0:`${G}50`,color:q||N?void 0:G},title:q?y?"請耐心等待物品加載完成":`版本 ${l} (無物品)`:`版本 ${l}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:G}}),e.jsx("span",{children:l})]})},l)})]})]})}),p&&e.jsxs("div",{className:"px-4 py-2 bg-purple-900/30 border-b border-purple-500/20 flex items-center gap-2 text-xs text-ffxiv-gold",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-ffxiv-gold"}),e.jsx("span",{children:"載入市場數據中..."})]}),e.jsxs("table",{className:"w-full border-collapse min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border-b border-purple-500/30",children:[e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-12 sm:w-16",children:"圖片"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-16 sm:w-20 cursor-pointer hover:bg-purple-800/40 transition-colors select-none",onClick:()=>Re("id"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["ilvl",e.jsx(fe,{column:"id"})]})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-20 sm:w-24",children:e.jsx("div",{className:"flex items-center gap-1",children:"版本"})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs min-w-[160px] sm:min-w-[200px] cursor-pointer hover:bg-purple-800/40 transition-colors select-none",onClick:()=>Re("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["物品名",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-ffxiv-gold opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",title:"點擊複製按鈕可複製物品名稱",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx(fe,{column:"name"})]})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-28 sm:w-32 cursor-pointer hover:bg-purple-800/40 transition-colors select-none",onClick:()=>Re("velocity"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["日均銷量",p?e.jsx("div",{className:"animate-spin rounded-full h-2.5 w-2.5 border-b border-ffxiv-gold"}):e.jsx(fe,{column:"velocity"})]})}),e.jsx("th",{className:`px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-36 sm:w-40 cursor-pointer hover:bg-purple-800/40 transition-colors select-none ${ct?"animate-pulse":""}`,onClick:()=>Re("averagePrice"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["全服平均價格",p?e.jsx("div",{className:"animate-spin rounded-full h-2.5 w-2.5 border-b border-ffxiv-gold"}):e.jsx(fe,{column:"averagePrice"})]})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-36 sm:w-40 cursor-pointer hover:bg-purple-800/40 transition-colors select-none",onClick:()=>Re("minListing"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["最低在售價",p?e.jsx("div",{className:"animate-spin rounded-full h-2.5 w-2.5 border-b border-ffxiv-gold"}):e.jsx(fe,{column:"minListing"})]})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-36 sm:w-40 cursor-pointer hover:bg-purple-800/40 transition-colors select-none",onClick:()=>Re("recentPurchase"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["最近成交價",p?e.jsx("div",{className:"animate-spin rounded-full h-2.5 w-2.5 border-b border-ffxiv-gold"}):e.jsx(fe,{column:"recentPurchase"})]})}),e.jsx("th",{className:`px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-24 sm:w-28 cursor-pointer hover:bg-purple-800/40 transition-colors select-none ${Nt?"animate-pulse":""}`,onClick:()=>Re("tradable"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["可交易",p?e.jsx("div",{className:"animate-spin rounded-full h-2.5 w-2.5 border-b border-ffxiv-gold"}):e.jsx(fe,{column:"tradable"})]})}),e.jsx("th",{className:"px-2 sm:px-4 py-2 text-left text-ffxiv-gold font-semibold text-xs w-40 sm:w-48",children:"鏈接"})]})}),e.jsx("tbody",{children:Ie.map((l,N)=>{const q=(I&&I>0?(u-1)*I:0)+N,G=q<5&&ve.length>0,ne=b?b[l.id]:void 0,J=s?s.has(l.id):!0,Z=ne!==void 0?ne:J||l.isTradable,_e=d?d[l.id]:void 0,xe=i?i[l.id]:void 0,Se=h?h[l.id]:void 0,Ce=c?c[l.id]:void 0;return e.jsxs("tr",{onClick:()=>n&&n(l),onMouseDown:be=>{if(be.button===1){be.preventDefault();const Oe=`/item/${l.id}`;window.open(Oe,"_blank","noopener,noreferrer")}},className:`border-b border-purple-500/20 cursor-pointer transition-colors ${o?.id===l.id?"bg-ffxiv-gold/20":"hover:bg-purple-900/30"}`,children:[e.jsx("td",{className:"px-2 sm:px-4 py-2",children:e.jsx(ts,{itemId:l.id,alt:l.name,className:"w-8 h-8 sm:w-10 sm:h-10 object-contain rounded border border-purple-500/30 bg-slate-900/50",priority:G,loadDelay:G?0:q>=5?(q-5)*200:0})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-right font-mono text-xs",children:se(l.id)!==null?e.jsx("span",{className:"text-green-400 font-semibold",children:se(l.id)}):e.jsx("span",{className:"text-gray-400",children:l.id})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-center",children:e.jsx(Tt,{version:er(l.id)})}),e.jsx(qn,{itemName:l.name,addToast:L}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-left text-xs",children:p?e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-slate-800/60 border border-slate-600/40",children:e.jsx("span",{className:"text-gray-500 animate-pulse",children:"..."})}):Z&&_e!==void 0&&_e!==null?e.jsxs("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-slate-800/60 border border-slate-600/40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-cyan-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("span",{className:"text-emerald-300 font-medium whitespace-nowrap",children:_e.toFixed(1)})]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-left text-xs",children:p?e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-slate-800/60 border border-slate-600/40",children:e.jsx("span",{className:"text-gray-500 animate-pulse",children:"..."})}):xe!==void 0?e.jsxs("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-slate-800/60 border border-slate-600/40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-ffxiv-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-ffxiv-gold font-medium whitespace-nowrap",children:xe.toLocaleString()})]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-left text-xs",children:p?e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-slate-800/60 border border-slate-600/40",children:e.jsx("span",{className:"text-gray-500 animate-pulse",children:"..."})}):Se!==void 0?e.jsxs("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-slate-800/60 border border-slate-600/40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-blue-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("span",{className:"text-blue-300 font-medium whitespace-nowrap",children:typeof Se=="object"?Se.price.toLocaleString():Se.toLocaleString()}),typeof Se=="object"&&Se.region&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",title:`區域: ${Se.region}`,children:["(",Se.region,")"]})]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-left text-xs",children:p?e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-slate-800/60 border border-slate-600/40",children:e.jsx("span",{className:"text-gray-500 animate-pulse",children:"..."})}):Ce!==void 0?e.jsxs("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-slate-800/60 border border-slate-600/40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-green-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-green-300 font-medium whitespace-nowrap",children:typeof Ce=="object"?Ce.price.toLocaleString():Ce.toLocaleString()}),typeof Ce=="object"&&Ce.region&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",title:`區域: ${Ce.region}`,children:["(",Ce.region,")"]})]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 text-left text-xs",children:p?e.jsx("span",{className:"text-gray-500 animate-pulse",children:"..."}):ne!==void 0?ne?e.jsx("span",{className:"inline-block px-1.5 py-0.5 text-[10px] bg-green-900/50 text-green-400 border border-green-500/30 rounded",children:"可交易"}):e.jsx("span",{className:"inline-block px-1.5 py-0.5 text-[10px] bg-red-900/50 text-red-400 border border-red-500/30 rounded",children:"不可交易"}):e.jsx("span",{className:"inline-block px-1.5 py-0.5 text-[10px] bg-red-900/50 text-red-400 border border-red-500/30 rounded",children:"不可交易"})}),e.jsx("td",{className:"px-2 sm:px-4 py-2",children:e.jsxs("div",{className:"flex gap-1 sm:gap-2 text-xs whitespace-nowrap",children:[e.jsx("button",{onClick:async be=>{be.stopPropagation();try{if(R){const Oe=await R(l.id);if(Oe){const Ee=`https://ff14.huijiwiki.com/wiki/${l.id>1e3||l.id<20?"物品:":""}${encodeURIComponent(Oe)}`;window.open(Ee,"_blank","noopener,noreferrer")}else{const Ee=`https://ff14.huijiwiki.com/wiki/${l.id>1e3||l.id<20?"物品:":""}${encodeURIComponent(l.name)}`;window.open(Ee,"_blank","noopener,noreferrer")}}else{const Ae=`https://ff14.huijiwiki.com/wiki/${l.id>1e3||l.id<20?"物品:":""}${encodeURIComponent(l.name)}`;window.open(Ae,"_blank","noopener,noreferrer")}}catch(Oe){console.error("Failed to open Wiki link:",Oe),L&&L("無法打開Wiki連結","error")}},className:"text-ffxiv-accent hover:text-ffxiv-gold transition-colors whitespace-nowrap bg-transparent border-none p-0 cursor-pointer",children:"Wiki"}),e.jsx("a",{href:`https://www.garlandtools.org/db/#item/${l.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-ffxiv-accent hover:text-ffxiv-gold transition-colors whitespace-nowrap",onClick:be=>be.stopPropagation(),children:"Garland"}),e.jsx("a",{href:`https://universalis.app/market/${l.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-ffxiv-accent hover:text-ffxiv-gold transition-colors whitespace-nowrap",onClick:be=>be.stopPropagation(),children:"Market"})]})})]},l.id||N)})})]})]})}function $n({listings:r,onRefresh:n}){if(!r||r.length===0)return e.jsx("div",{className:"flex-1 flex items-center justify-center text-center py-8 text-gray-400 bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20",children:e.jsx("p",{children:"暫無在售列表"})});const o=[...r].sort((s,d)=>s.pricePerUnit-d.pricePerUnit);return e.jsx("div",{className:"flex-1 flex flex-col overflow-x-auto bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20",children:e.jsxs("table",{className:"w-full border-collapse text-sm min-w-[600px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border-b border-purple-500/30",children:[e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs min-w-[140px] sm:min-w-[180px]",children:"物品名"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-20 sm:w-24",children:"單價"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-16 sm:w-20",children:"數量"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-20 sm:w-24",children:"總計"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs hidden sm:table-cell min-w-[80px]",children:"雇員"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs min-w-[80px] sm:min-w-[100px]",children:"服務器"})]})}),e.jsx("tbody",{children:o.map((s,d)=>e.jsxs("tr",{className:"border-b border-purple-500/20 hover:bg-purple-900/30 transition-colors",children:[e.jsx("td",{className:"px-2 sm:px-3 py-2 text-white text-xs break-words",style:{minWidth:"140px",maxWidth:"240px"},children:e.jsxs("div",{className:"flex items-start gap-1 flex-wrap",children:[e.jsx("span",{className:"block min-w-0",style:{wordBreak:"break-word",lineHeight:"1.4"},title:s.itemName,children:s.itemName}),s.hq&&e.jsx("span",{className:"px-1 py-0.5 bg-ffxiv-gold/20 text-ffxiv-gold rounded text-xs whitespace-nowrap flex-shrink-0",children:"HQ"})]})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-green-400 font-semibold text-xs whitespace-nowrap",children:s.pricePerUnit.toLocaleString()}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-gray-300 text-xs whitespace-nowrap",children:s.quantity}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs whitespace-nowrap",children:s.total.toLocaleString()}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-400 text-xs hidden sm:table-cell truncate max-w-[100px]",title:s.retainerName||"-",children:s.retainerName||"-"}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-400 text-xs truncate max-w-[120px]",title:s.worldName,children:s.worldName})]},d))})]})})}function _n({history:r}){if(!r||r.length===0)return e.jsx("div",{className:"flex-1 flex items-center justify-center text-center py-8 text-gray-400 bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20",children:e.jsx("p",{className:"text-sm",children:"暫無歷史交易記錄"})});const n=[...r].sort((o,s)=>s.timestamp-o.timestamp);return e.jsx("div",{className:"flex-1 flex flex-col overflow-x-auto bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20",children:e.jsxs("table",{className:"w-full border-collapse text-sm min-w-[600px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border-b border-purple-500/30",children:[e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs min-w-[80px] sm:min-w-[100px]",children:"物品名"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-20 sm:w-24",children:"單價"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-16 sm:w-20",children:"數量"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs w-20 sm:w-24",children:"總計"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs hidden sm:table-cell min-w-[80px]",children:"買家"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs min-w-[80px] sm:min-w-[100px]",children:"服務器"}),e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-ffxiv-gold font-semibold text-xs w-16 sm:w-20",children:"時間"})]})}),e.jsx("tbody",{children:n.map((o,s)=>e.jsxs("tr",{className:"border-b border-purple-500/20 hover:bg-purple-900/30 transition-colors",children:[e.jsx("td",{className:"px-2 sm:px-3 py-2 text-white text-xs break-words",style:{minWidth:"80px",maxWidth:"150px"},children:e.jsxs("div",{className:"flex items-start gap-1 flex-wrap",children:[e.jsx("span",{className:"block min-w-0",style:{wordBreak:"break-word",lineHeight:"1.4"},title:o.itemName,children:o.itemName}),o.hq&&e.jsx("span",{className:"px-1 py-0.5 bg-ffxiv-gold/20 text-ffxiv-gold rounded text-xs whitespace-nowrap flex-shrink-0",children:"HQ"})]})}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-green-400 font-semibold text-xs whitespace-nowrap",children:o.pricePerUnit.toLocaleString()}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-gray-300 text-xs whitespace-nowrap",children:o.quantity}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-right text-ffxiv-gold font-semibold text-xs whitespace-nowrap",children:o.total.toLocaleString()}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-400 text-xs hidden sm:table-cell truncate max-w-[100px]",title:o.buyerName||"-",children:o.buyerName||"-"}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-400 text-xs truncate max-w-[120px]",title:o.worldName,children:o.worldName}),e.jsx("td",{className:"px-2 sm:px-3 py-2 text-gray-400 text-xs whitespace-nowrap",children:(()=>{const d=new Date(o.timestamp*1e3),i=String(d.getMonth()+1).padStart(2,"0"),h=String(d.getDate()).padStart(2,"0"),c=String(d.getHours()).padStart(2,"0"),b=String(d.getMinutes()).padStart(2,"0");return`${i}/${h} ${c}:${b}`})()})]},s))})]})})}function Ds(r){return r?r>1e10?Math.floor(r/1e3):r:null}function gs(r){if(!r)return"未知";const n=Ds(r);if(!n)return"未知";const s=Math.floor(Date.now()/1e3)-n;if(s<0)return"0分鐘前";if(s<60)return"1分鐘前";if(s<3600)return`${Math.floor(s/60)}分鐘前`;if(s<86400){const h=Math.floor(s/3600),c=Math.floor(s%3600/60);return c>0?`${h}小時${c}分鐘前`:`${h}小時前`}if(s<604800){const h=Math.floor(s/86400),c=Math.floor(s%86400/3600);return c>0?`${h}天${c}小時前`:`${h}天前`}const d=Math.floor(s/604800),i=Math.floor(s%604800/86400);return i>0?`${d}週${i}天前`:`${d}週前`}function Xr(r){if(!r)return"未知";const n=Ds(r);if(!n)return"未知";const o=new Date(n*1e3),s=o.getFullYear(),d=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0"),h=String(o.getHours()).padStart(2,"0"),c=String(o.getMinutes()).padStart(2,"0"),b=-o.getTimezoneOffset(),p=Math.floor(Math.abs(b)/60),R=Math.abs(b)%60,u=`${b>=0?"+":"-"}${String(p).padStart(2,"0")}:${String(R).padStart(2,"0")}`,I=Intl.DateTimeFormat().resolvedOptions().timeZone;return`${s}-${d}-${i} ${h}:${c} ${I} ${u}`}function An({worldUploadTimes:r,worlds:n,dcWorlds:o}){const[s,d]=t.useState({show:!1,x:0,y:0,content:""}),[i,h]=t.useState(null),c=t.useRef(null),b=t.useRef(null);if(!r||!n||!o||o.length===0)return null;const p=o.map(w=>({worldId:w,worldName:n[w]||`伺服器 ${w}`,uploadTime:r[w]||r[String(w)]||null})),R=w=>{if(!w)return"text-gray-500";const m=w>1e10?Math.floor(w/1e3):w,E=Math.floor(Date.now()/1e3)-m;return E<3600?"text-emerald-400":E<21600?"text-yellow-400":E<86400?"text-amber-400":E<259200?"text-orange-400":"text-red-400"},L=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,u=(w,m)=>{let X=w.left+w.width/2;const S=280/2+8,z=window.innerWidth-280/2-8;X=Math.max(S,Math.min(z,X));const H=m.top-8;return{x:X,y:H}},I=(w,m)=>{if(!m||!c.current)return;const y=w.currentTarget.getBoundingClientRect(),E=c.current.getBoundingClientRect(),X=Xr(m),S=u(y,E);d({show:!0,x:S.x,y:S.y,content:X})},f=(w,m)=>{L()||I(w,m)},O=()=>{!L()&&i===null&&d({show:!1,x:0,y:0,content:""})},g=(w,m,y)=>{L()&&(i===y?(h(null),d({show:!1,x:0,y:0,content:""})):(h(y),I(w,m)))};t.useEffect(()=>{const w=m=>{L()&&i!==null&&b.current&&!b.current.contains(m.target)&&(h(null),d({show:!1,x:0,y:0,content:""}))};return i!==null&&(document.addEventListener("touchstart",w),document.addEventListener("click",w)),()=>{document.removeEventListener("touchstart",w),document.removeEventListener("click",w)}},[i]),t.useEffect(()=>{const w=()=>{if(s.show&&c.current){const m=document.querySelector(`[data-cell-id="${i}"]`);if(m){const y=m.getBoundingClientRect(),E=c.current.getBoundingClientRect(),X=u(y,E);d(S=>({...S,x:X.x,y:X.y}))}}};return window.addEventListener("scroll",w,!0),window.addEventListener("resize",w),()=>{window.removeEventListener("scroll",w,!0),window.removeEventListener("resize",w)}},[s.show,i]);const te=()=>s.show?e.jsxs("div",{ref:b,className:"fixed px-2 sm:px-3 py-1.5 sm:py-2 bg-gradient-to-br from-slate-900/98 via-purple-900/95 to-slate-900/98 backdrop-blur-md text-white text-xs sm:text-sm rounded-lg shadow-2xl pointer-events-auto sm:pointer-events-none whitespace-normal sm:whitespace-nowrap z-[999999] border border-purple-500/60 glow-blue max-w-[90vw] sm:max-w-none sm:min-w-max",style:{left:`${s.x}px`,bottom:`${window.innerHeight-s.y}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-ffxiv-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-ffxiv-gold font-semibold break-words",children:s.content})]})}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-px",children:e.jsx("div",{className:"border-4 border-transparent border-t-purple-900/95"})}),e.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-br from-purple-500/20 via-transparent to-purple-500/20 pointer-events-none"})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx(te,{}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-2 sm:p-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5 text-ffxiv-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h4",{className:"text-sm sm:text-base md:text-lg font-semibold text-ffxiv-gold truncate",children:"物品資料最後上報時間"})]}),e.jsx("div",{className:"relative overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full px-2 sm:px-0",children:e.jsx("div",{ref:c,className:"bg-purple-900/20 rounded border border-purple-500/20 overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 divide-x divide-purple-500/20",children:p.map(({worldId:w,worldName:m,uploadTime:y})=>{const E=R(y),X=`name-${w}`,S=`time-${w}`,z=i===X,H=i===S;return e.jsxs("div",{className:"flex flex-col border-b border-purple-500/20 last:border-b-0",children:[e.jsx("div",{"data-cell-id":X,className:`group relative py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-medium text-gray-200 text-center truncate transition-colors hover:text-ffxiv-gold active:text-ffxiv-gold cursor-pointer select-none ${z?"text-ffxiv-gold":""}`,style:{touchAction:"manipulation"},onMouseEnter:de=>f(de,y),onMouseLeave:O,onClick:de=>g(de,y,X),title:y?Xr(y):"無數據",children:e.jsx("span",{className:"truncate block",children:m})}),e.jsx("div",{"data-cell-id":S,className:`group relative py-1.5 sm:py-2 px-1 sm:px-2 text-xs text-center font-medium transition-colors cursor-pointer select-none ${H?"text-ffxiv-gold":E} hover:text-ffxiv-gold active:text-ffxiv-gold`,style:{touchAction:"manipulation"},onMouseEnter:de=>f(de,y),onMouseLeave:O,onClick:de=>g(de,y,S),title:y?Xr(y):"無數據",children:y?e.jsx("span",{className:"inline-block truncate max-w-full",title:gs(y),children:gs(y)}):e.jsx("span",{className:"text-gray-500 italic",children:"無數據"})})]},w)})})})})})]})]})}function Dn({message:r,type:n="info",duration:o=3e3,onClose:s}){const[d,i]=t.useState(!0),h=t.useRef(s),c=t.useRef(null);if(t.useEffect(()=>{h.current=s},[s]),t.useEffect(()=>{if(o>0)return c.current=setTimeout(()=>{i(!1),setTimeout(()=>{h.current?.()},300)},o),()=>{c.current&&clearTimeout(c.current)}},[o]),!d)return null;const b={info:"bg-ffxiv-blue/90",success:"bg-green-600/90",warning:"bg-yellow-600/90",error:"bg-red-600/90"}[n];return e.jsx("div",{className:`${b} text-white px-4 py-3 rounded-lg shadow-lg backdrop-blur-sm border border-white/20 animate-fadeIn mb-2`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:r}),e.jsx("button",{onClick:()=>{c.current&&clearTimeout(c.current),i(!1),setTimeout(()=>{h.current?.()},300)},className:"ml-4 text-white/80 hover:text-white",children:"×"})]})})}class Fn{constructor(){this.lastRequestTime=0,this.minRequestInterval=500,this.pendingRequests=new Map,this.rateLimitRetryDelay=2e3}shouldWait(){return Date.now()-this.lastRequestTime<this.minRequestInterval}getWaitTime(){const o=Date.now()-this.lastRequestTime;return o<this.minRequestInterval?this.minRequestInterval-o:0}updateLastRequestTime(){this.lastRequestTime=Date.now()}isRateLimitError(n){return!n||!n.response?!1:n.response.status===429||n.response.status===503||n.response.status>=500&&n.response.status<600}getRetryDelay(n){return Math.min(this.rateLimitRetryDelay*Math.pow(2,n),1e4)}async makeRequest(n,o={}){const{maxRetries:s=3,onRateLimit:d}=o,i=this.getWaitTime();i>0&&await new Promise(c=>setTimeout(c,i));let h=null;for(let c=0;c<=s;c++)try{return this.updateLastRequestTime(),await n()}catch(b){if(h=b,this.isRateLimitError(b)){const p=this.getRetryDelay(c);if(d&&d(c,p),c>=s)throw new Error("請求頻率過高，請稍後再試");await new Promise(R=>setTimeout(R,p));continue}throw b}throw h}}const $s=new Fn,rs="https://universalis.app/api/v2";let Yr=null;async function Jr(){if(Yr)return Yr;try{const n=(await Te(()=>import("./data-other-BAzrwk9S.js").then(o=>o.h),[])).default;return Yr=new Set(n),Yr}catch(r){return console.error("Error loading marketable items:",r),new Set}}async function On(r){return(await Jr()).has(r)}async function ca(r,n=20,o={}){if(o.signal&&o.signal.aborted)return null;try{const s={params:{dcName:r,entries:n}};return o.signal&&(s.signal=o.signal),(await Zr.get(`${rs}/extra/stats/most-recently-updated`,s)).data?.items||[]}catch(s){return s.name==="AbortError"||s.code==="ERR_CANCELED"||o.signal&&o.signal.aborted?null:(console.error("Error fetching most recently updated items:",s),[])}}async function Wn(r,n,o={}){if(o.signal&&o.signal.aborted)return null;try{return await $s.makeRequest(async()=>{const d={listings:o.listings||20,entries:o.entries||20};o.hq&&(d.hq=!0);const i={params:d,validateStatus:c=>c===200||c===404};o.signal&&(i.signal=o.signal);const h=await Zr.get(`${rs}/${r}/${n}`,i);return h.status===404?null:h.data},{maxRetries:2,onRateLimit:(d,i)=>{}})}catch(s){if(s.name==="AbortError"||s.code==="ERR_CANCELED"||o.signal&&o.signal.aborted||s.response?.status===404)return null;throw $s.isRateLimitError(s)?new Error("請求頻率過高，請稍後再試"):(console.error(`Error fetching market data for ${r}:`,s),s)}}async function da(r,n,o={},s={}){if(s.signal&&s.signal.aborted)return{};if(!n||n.length===0)return{};const i=n.slice(0,100).join(","),h=typeof r=="number"||typeof r=="string"&&!isNaN(Number(r));try{const c={};s.signal&&(c.signal=s.signal);const b=await Zr.get(`${rs}/aggregated/${encodeURIComponent(r)}/${i}`,c),p={},R=b.data;return R&&R.results&&R.results.forEach(L=>{const u=L.itemId;let I=null,f=!1,O=null,g="average";if(h){const z=L.nq?.averageSalePrice?.world?.price,H=L.hq?.averageSalePrice?.world?.price,de=L.nq?.minListing?.world,ge=L.hq?.minListing?.world;z&&H?H<=z?(I=Math.round(H),f=!0,g="average"):(I=Math.round(z),f=!1,g="average"):H?(I=Math.round(H),f=!0,g="average"):z?(I=Math.round(z),f=!1,g="average"):de?.price&&ge?.price?ge.price<=de.price?(I=ge.price,f=!0,g="minListing"):(I=de.price,f=!1,g="minListing"):ge?.price?(I=ge.price,f=!0,g="minListing"):de?.price&&(I=de.price,f=!1,g="minListing")}else{const z=L.nq?.minListing?.dc,H=L.hq?.minListing?.dc;g="minListing",z?.price&&H?.price?H.price<=z.price?(I=H.price,f=!0,O=o[H.worldId]||`伺服器 ${H.worldId}`):(I=z.price,f=!1,O=o[z.worldId]||`伺服器 ${z.worldId}`):H?.price?(I=H.price,f=!0,O=o[H.worldId]||`伺服器 ${H.worldId}`):z?.price&&(I=z.price,f=!1,O=o[z.worldId]||`伺服器 ${z.worldId}`)}let te=null,w=null;const m=L.nq?.dailySaleVelocity?.world?.quantity,y=L.hq?.dailySaleVelocity?.world?.quantity,E=L.nq?.dailySaleVelocity?.dc?.quantity,X=L.hq?.dailySaleVelocity?.dc?.quantity;(m!==void 0||y!==void 0)&&(te=(m||0)+(y||0)),(E!==void 0||X!==void 0)&&(w=(E||0)+(X||0));const S={price:I,isHQ:f,priceType:g};O&&(S.worldName=O),te!==null&&(S.velocityWorld=te),w!==null&&(S.velocityDc=w),(I!==null||te!==null||w!==null)&&(p[u]=S)}),p}catch(c){return c.name==="AbortError"||c.code==="ERR_CANCELED"||s.signal&&s.signal.aborted?{}:(console.error(`Error fetching aggregated market data for ${r}:`,c),{})}}async function Bn(r){try{return(await Zr.get(`${rs}/tax-rates`,{params:{world:r}})).data}catch(n){return console.error(`Error fetching tax rates for ${r}:`,n),null}}function Fe(r){return`/market_tester/${r}`}function xs({onItemSelect:r,compact:n=!1,setSearchText:o,isItemInfoPage:s=!1}){const d=Gr(),i=vs(),[h,c]=t.useState(!1),b=t.useRef(null),p=t.useRef(null),{historyItems:R,isLoading:L,clearHistory:u}=ws();t.useEffect(()=>{const m=y=>{b.current&&!b.current.contains(y.target)&&c(!1)};return h&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m),p.current&&clearTimeout(p.current)}},[h]);const I=()=>{p.current&&clearTimeout(p.current),c(!0)},f=()=>{p.current=setTimeout(()=>{c(!1)},200)},O=m=>{r&&r(m),c(!1)},g=m=>{if(m.preventDefault(),m.stopPropagation(),i.pathname==="/history"){c(!1);return}p.current&&(clearTimeout(p.current),p.current=null),c(!1),o&&o(""),d("/history")},te=m=>{m.stopPropagation(),window.confirm("確定要清空所有歷史記錄嗎？")&&(u(),c(!1))},w=i.pathname==="/history";return e.jsxs("div",{ref:b,className:"relative",onMouseEnter:I,onMouseLeave:f,children:[e.jsxs("button",{onClick:g,onMouseDown:m=>m.stopPropagation(),className:s?`topbar-nav-button item-info-page ${w?"active":""}`:`bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border rounded-lg backdrop-blur-sm whitespace-nowrap flex items-center transition-colors ${n?"px-2 h-8 gap-1.5":"px-2 mid:px-3 detail:px-4 h-9 mid:h-12 gap-1.5 mid:gap-2"} ${w?"border-ffxiv-gold/70 shadow-[0_0_10px_rgba(212,175,55,0.3)]":"border-purple-500/30 hover:border-ffxiv-gold/50"}`,title:"歷史記錄",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s?"topbar-nav-icon item-info-page":"h-4 w-4 mid:h-5 mid:w-5 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s?e.jsx("span",{className:"topbar-nav-text item-info-page",children:"歷史記錄"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs detail:text-sm font-semibold text-ffxiv-gold hidden mid:inline",children:"歷史記錄"}),e.jsx("span",{className:"text-xs font-semibold text-ffxiv-gold hidden narrow:inline mid:hidden",children:"歷史"})]})]}),h&&e.jsx("div",{className:"absolute top-full left-0 mt-2 w-64 mid:w-80 bg-slate-900/95 backdrop-blur-sm border border-purple-500/30 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto",onMouseEnter:()=>{p.current&&clearTimeout(p.current)},onMouseLeave:f,children:L?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-ffxiv-gold mx-auto"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"載入中..."})]}):R.length===0?e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-400",children:"暫無歷史記錄"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 border-b border-purple-500/20 relative",children:[e.jsxs("p",{className:"text-xs text-ffxiv-gold font-semibold",children:["最近查看 (",R.length,")"]}),e.jsx("button",{onClick:te,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-red-400 transition-colors group",title:"清空歷史記錄",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"py-1",children:R.map(m=>e.jsxs("button",{onClick:()=>O(m),className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-purple-900/30 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ts,{itemId:m.id,alt:m.name,className:"w-10 h-10 object-contain rounded border border-purple-500/30 bg-slate-900/50"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-white font-medium truncate",title:m.name,children:m.name}),e.jsxs("p",{className:"text-xs text-gray-400",children:["ID: ",m.id]})]})]},m.id))})]})})]})}function Hn({onSearch:r,isSearching:n,searchText:o,setSearchText:s,isServerDataLoaded:d,selectedDcName:i,onItemSelect:h,searchResults:c=[],marketableItems:b=null,selectedItem:p,getSimplifiedChineseName:R,addToast:L,showNavigationButtons:u=!0,activePage:I=null,onMSQPriceCheckerClick:f,onUltimatePriceKingClick:O,onAdvancedSearchClick:g,onTaxRatesClick:te}){const w=Gr(),m=vs(),y=I||(m.pathname==="/ultimate-price-king"?"ultimate-price-king":m.pathname==="/msq-price-checker"?"msq-price-checker":m.pathname==="/advanced-search"?"advanced-search":m.pathname==="/history"?"history":null),E=()=>{m.pathname!=="/advanced-search"&&(g?g():(s&&s(""),w("/advanced-search")))},X=()=>{m.pathname!=="/msq-price-checker"&&(f?f():(s(""),w("/msq-price-checker")))},S=()=>{m.pathname!=="/ultimate-price-king"&&(O?O():(s(""),w("/ultimate-price-king")))},z=!!p,H=d?"topbar-logo-loaded":"topbar-logo-loading",de=(ge="")=>z?e.jsxs("div",{className:`topbar-external-links ${ge}`,children:[e.jsxs("button",{onClick:async()=>{try{if(R){const ue=await R(p.id);if(ue){const ce=`https://ff14.huijiwiki.com/wiki/${p.id>1e3||p.id<20?"物品:":""}${encodeURIComponent(ue)}`;window.open(ce,"_blank","noopener,noreferrer")}else{const ce=`https://ff14.huijiwiki.com/wiki/${p.id>1e3||p.id<20?"物品:":""}${encodeURIComponent(p.name)}`;window.open(ce,"_blank","noopener,noreferrer")}}else{const $=`https://ff14.huijiwiki.com/wiki/${p.id>1e3||p.id<20?"物品:":""}${encodeURIComponent(p.name)}`;window.open($,"_blank","noopener,noreferrer")}}catch(ue){console.error("Failed to open Wiki link:",ue),L&&L("無法打開Wiki連結","error")}},className:"topbar-external-link",title:"Wiki",children:[e.jsx("span",{className:"topbar-external-link-full",children:"Wiki"}),e.jsx("span",{className:"topbar-external-link-short",children:"W"})]}),e.jsxs("a",{href:`https://www.garlandtools.org/db/#item/${p.id}`,target:"_blank",rel:"noopener noreferrer",className:"topbar-external-link",title:"Garland",children:[e.jsx("span",{className:"topbar-external-link-full",children:"Garland"}),e.jsx("span",{className:"topbar-external-link-short",children:"G"})]}),e.jsxs("a",{href:`https://universalis.app/market/${p.id}`,target:"_blank",rel:"noopener noreferrer",className:"topbar-external-link",title:"Market",children:[e.jsx("span",{className:"topbar-external-link-full",children:"Market"}),e.jsx("span",{className:"topbar-external-link-short",children:"M"})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w("/"),className:"topbar-desktop-logo",title:"返回主頁",children:e.jsx("img",{src:`${Fe("logo.png")}?v=2`,alt:"返回主頁",className:H})}),e.jsx("div",{className:`topbar-container ${z?"item-info-page":""}`,children:z?e.jsxs("div",{className:"topbar-item-info-wrapper",children:[e.jsxs("div",{className:"topbar-item-info-first-row",children:[e.jsx("button",{onClick:()=>w("/"),className:"topbar-mobile-logo",title:"返回主頁",children:e.jsx("img",{src:`${Fe("logo.png")}?v=2`,alt:"返回主頁",className:H})}),e.jsx("div",{className:"topbar-search-container item-info-page",children:e.jsx(ps,{onSearch:r,isLoading:n,value:o,onChange:s,disabled:!d,disabledTooltip:d?void 0:"請等待伺服器資料載入完成",selectedDcName:i,onItemSelect:h,searchResults:c,marketableItems:b})}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"topbar-nav-button-container item-info-page-desktop",children:e.jsxs("button",{onClick:E,className:`topbar-nav-button item-info-page ${y==="advanced-search"?"active":""}`,title:"進階搜尋",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"進階搜尋"})]})}),e.jsx("div",{className:"topbar-nav-button-container item-info-page-desktop",children:e.jsx(xs,{onItemSelect:h,setSearchText:s,isItemInfoPage:!0})}),e.jsx("div",{className:"topbar-nav-separator item-info-page item-info-page-desktop"}),e.jsx("div",{className:"topbar-nav-button-container item-info-page-desktop",children:e.jsxs("button",{onClick:S,className:`topbar-nav-button item-info-page ${y==="ultimate-price-king"?"active":""}`,title:"製造職找價",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"製造靈感"})]})}),e.jsx("div",{className:"topbar-nav-button-container item-info-page-desktop",children:e.jsxs("button",{onClick:X,className:`topbar-nav-button item-info-page ${y==="msq-price-checker"?"active":""}`,title:"主線裝備查價",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"主線裝備"})]})}),e.jsx("div",{className:"topbar-nav-button-container item-info-page-desktop",children:e.jsxs("button",{onClick:te,className:"topbar-nav-button item-info-page",title:"查稅",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"查稅"})]})})]})]}),e.jsx("div",{className:"topbar-item-info-external-links",children:de()}),u&&e.jsxs("div",{className:"topbar-item-info-nav-row",children:[e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:E,className:`topbar-nav-button item-info-page ${y==="advanced-search"?"active":""}`,title:"進階搜尋",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"進階搜尋"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsx(xs,{onItemSelect:h,setSearchText:s,isItemInfoPage:!0})}),e.jsx("div",{className:"topbar-nav-separator item-info-page"}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:S,className:`topbar-nav-button item-info-page ${y==="ultimate-price-king"?"active":""}`,title:"製造職找價",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"製造靈感"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:X,className:`topbar-nav-button item-info-page ${y==="msq-price-checker"?"active":""}`,title:"主線裝備查價",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"主線裝備"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:te,className:"topbar-nav-button item-info-page",title:"查稅",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon item-info-page",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"topbar-nav-text item-info-page",children:"查稅"})]})})]})]}):e.jsxs("div",{className:"topbar-first-row",children:[e.jsx("button",{onClick:()=>w("/"),className:"topbar-mobile-logo",title:"返回主頁",children:e.jsx("img",{src:`${Fe("logo.png")}?v=2`,alt:"返回主頁",className:H})}),e.jsx("div",{className:"topbar-search-container",children:e.jsx(ps,{onSearch:r,isLoading:n,value:o,onChange:s,disabled:!d,disabledTooltip:d?void 0:"請等待伺服器資料載入完成",selectedDcName:i,onItemSelect:h,searchResults:c,marketableItems:b})}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:E,className:`topbar-nav-button ${y==="advanced-search"?"active":""}`,title:"進階搜尋",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})}),e.jsx("span",{className:"topbar-nav-text",children:"進階搜尋"}),e.jsx("span",{className:"topbar-nav-text narrow-only",children:"進階"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsx(xs,{onItemSelect:h,setSearchText:s,isItemInfoPage:!1})}),e.jsx("div",{className:"topbar-nav-separator"}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:S,className:`topbar-nav-button ${y==="ultimate-price-king"?"active":""}`,title:"製造職找價",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"topbar-nav-text",children:"製造靈感"}),e.jsx("span",{className:"topbar-nav-text narrow-only",children:"感"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:X,className:`topbar-nav-button ${y==="msq-price-checker"?"active":""}`,title:"主線裝備查價",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{className:"topbar-nav-text",children:"主線裝備"}),e.jsx("span",{className:"topbar-nav-text narrow-only",children:"裝備"})]})}),e.jsx("div",{className:"topbar-nav-button-container",children:e.jsxs("button",{onClick:te,className:"topbar-nav-button",title:"查稅",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"topbar-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"topbar-nav-text",children:"查稅"})]})})]})]})})]})}function Vn(){const r=Gr(),[n,o]=t.useState(2);return t.useEffect(()=>{const s=setInterval(()=>{o(i=>i<=1?(clearInterval(s),r("/",{replace:!0}),0):i-1)},1e3),d=setTimeout(()=>{r("/",{replace:!0})},2e3);return()=>{clearInterval(s),clearTimeout(d)}},[r]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-2xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-9xl sm:text-[12rem] font-bold text-ffxiv-gold text-glow mb-4 animate-fadeIn",children:"404"}),e.jsx("div",{className:"w-32 h-1 bg-gradient-to-r from-transparent via-ffxiv-gold to-transparent mx-auto opacity-60"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-8 sm:p-12 mb-8 card-glow",children:[e.jsx("div",{className:"text-6xl mb-6",children:"🔍"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-ffxiv-gold mb-4",children:"頁面未找到"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-300 mb-6",children:"抱歉，您訪問的頁面不存在或已被移除。"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-400",children:n>0?e.jsxs("span",{children:["將在 ",e.jsx("span",{className:"text-ffxiv-gold font-bold",children:n})," 秒後自動返回首頁..."]}):e.jsx("span",{className:"text-ffxiv-gold",children:"正在跳轉..."})})]}),e.jsx("button",{onClick:()=>r("/",{replace:!0}),className:"px-6 py-3 bg-gradient-to-r from-purple-900/60 via-indigo-900/50 to-purple-900/60 border border-ffxiv-gold/40 text-ffxiv-gold font-semibold rounded-lg hover:border-ffxiv-gold/60 hover:shadow-[0_0_20px_rgba(251,191,36,0.4)] transition-all duration-300",children:"立即返回首頁"})]})})}const zn=t.lazy(()=>Te(()=>import("./ObtainMethods-GlTT2shJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Un=t.lazy(()=>Te(()=>import("./UltimatePriceKing-DvENx_BI.js"),__vite__mapDeps([12,1,2,3,4,5,6,13,11,8]))),Kn=t.lazy(()=>Te(()=>import("./MSQPriceChecker-dlZbV28U.js"),__vite__mapDeps([14,1,2,3,4,5,6,11,9]))),Qn=t.lazy(()=>Te(()=>import("./AdvancedSearch-C4imI9IK.js"),__vite__mapDeps([15,1,2,3,4,5,6,8,11]))),Yn=t.lazy(()=>Te(()=>import("./CraftingTree-wdkwG18M.js"),__vite__mapDeps([16,5,6,1,2,3,4,13,11]))),Xn=t.lazy(()=>Te(()=>import("./RelatedItems-BO8JHgY2.js"),__vite__mapDeps([17,5,6,1,2,3,4,13,7,11]))),Jn=t.lazy(()=>Te(()=>import("./HistorySection-CmNIxODY.js"),__vite__mapDeps([18,5,6,1,2,3,4,11]))),Gn=t.lazy(()=>Te(()=>import("./RecentUpdatesSection-Dr8KdBpc.js"),__vite__mapDeps([19,5,6,1,2,3,4,11])));function Zn(){const r=Gr(),[n]=un(),o=mn(),s=vs(),[d,i]=t.useState(""),[h,c]=t.useState([]),[b,p]=t.useState([]),[R,L]=t.useState(!1),[u,I]=t.useState(null),[f,O]=t.useState(null),[g,te]=t.useState(null),[w,m]=t.useState(null),[y,E]=t.useState([]),[X,S]=t.useState([]),[z,H]=t.useState(!1),[de,ge]=t.useState(!1),[ue,$]=t.useState(null),[ce,re]=t.useState(20),[Ze,Zt]=t.useState(!1),[Ye,Xe]=t.useState([]),[me,C]=t.useState({}),[Y,K]=t.useState(!0),[se,er]=t.useState(!1),[Tt,qe]=t.useState(!1),[ve,Ie]=t.useState(0),[Nt,ct]=t.useState([]),[Re,fe]=t.useState(null),[dt,$e]=t.useState(()=>Math.random()<.5?Fe("bear.png"):Fe("sheep.png")),[kt,Nr]=t.useState(!1),[Ot,Wt]=t.useState(!1),[l,N]=t.useState([]),T=t.useRef(null),q=t.useRef(0),G=t.useRef(3500),[ne,J]=t.useState(null),[Z,_e]=t.useState(!1),[xe,Se]=t.useState(!1),[Ce,be]=t.useState(!1),[Oe,Ae]=t.useState(!1),[Ee,qt]=t.useState(()=>{const a=localStorage.getItem("craftingTreeExcludeCrystals");return a!==null?a==="true":!0}),[ut,ss]=t.useState(!1),[tr,kr]=t.useState(!1),[Sr,ns]=t.useState(!1),[rr,sr]=t.useState(!1),[Fs,ys]=t.useState(!1),[Cr,Os]=t.useState(null),[Ws,nr]=t.useState({}),[Bs,ar]=t.useState({}),[Hs,or]=t.useState({}),[Vs,lr]=t.useState({}),[as,Bt]=t.useState({}),[zs,ir]=t.useState(!1),[pt,Ve]=t.useState(!0),[ze,Rr]=t.useState(1),[We,Us]=t.useState(100),[Ks,cr]=t.useState(!1),Ht=t.useRef(null),[Lr,os]=t.useState({}),[Ir,dr]=t.useState(!1),[Vt,St]=t.useState(!1),Er=t.useCallback(a=>{Rr(a),window.scrollTo({top:0,behavior:"smooth"})},[]),{historyItems:$t,isLoading:Qs,clearHistory:Ys}=ws(),[Xs,ur]=t.useState({}),[Js,mr]=t.useState({}),[Gs,fr]=t.useState({}),[Zs,xr]=t.useState({}),[en,zt]=t.useState({}),[Ns,Ut]=t.useState(!1),Ne=t.useRef(null),Ct=t.useRef(0),et=t.useRef(0),he=t.useRef(null),Rt=t.useRef(!1),tt=t.useRef(!1),rt=t.useRef(0),Me=t.useRef(null),_t=t.useRef(!1),hr=t.useRef(!1),Lt=t.useRef(null),st=t.useRef(0),Be=t.useRef(null),It=t.useRef([]),pr=t.useRef(null),tn=t.useRef(0),De=t.useRef(""),Kt=t.useRef(!1),Qt=t.useRef(null),mt=t.useRef(0),Je=t.useRef(!1),gt=t.useRef(""),ke=t.useRef(null),At=t.useRef(null),nt=t.useRef(!1),Mr=t.useRef(""),Pr=t.useRef(0),Tr=t.useRef(!1),Yt=t.useRef(null),ft=t.useRef(0),vt=t.useRef(!1),bt=t.useRef(""),qr=t.useRef(null),$r=t.useCallback(async()=>{if(qr.current)return qr.current;const a=await Te(()=>import("./data-other-BAzrwk9S.js").then(x=>x.c),[]);return qr.current=a.default,qr.current},[]),_r=t.useRef(null),Ar=t.useRef(null),ks=t.useCallback(async()=>{if(_r.current)return _r.current;const a=await Te(()=>import("./data-other-BAzrwk9S.js").then(x=>x.d),[]);return _r.current=a.default,_r.current},[]),Ss=t.useCallback(async()=>{if(Ar.current)return Ar.current;const a=await Te(()=>import("./data-other-BAzrwk9S.js").then(x=>x.g),[]);return Ar.current=a.default,Ar.current},[]),[ls,rn]=t.useState(null),[is,sn]=t.useState(null),[cs,nn]=t.useState(null);t.useEffect(()=>{Promise.all([$r(),ks(),Ss()]).then(([a,x,v])=>{rn(a),sn(x),nn(v)})},[$r,ks,Ss]);const an=t.useCallback(a=>!ls||!a?null:ls[a.toString()]||null,[ls]),on=t.useCallback(a=>{if(!is||!cs||!a)return null;const x=is[a.toString()];if(x==null)return null;const v=cs[x.toString()];if(!v||!v.version)return null;const k=parseFloat(v.version);return isNaN(k)?v.version:(Math.floor(k*10)/10).toFixed(1)},[is,cs]),Dr=["#4A90E2","#7B68EE","#FF6B6B","#FFD93D","#6BCF7F","#FF8C42","#9B59B6","#1ABC9C","#E74C3C","#3498DB","#F39C12","#16A085","#E67E22","#C0392B","#8E44AD","#27AE60","#2980B9","#D35400","#34495E","#95A5A6"],gr=t.useCallback(a=>{if(!a)return"#9CA3AF";const v=parseInt(a.split(".")[0],10)-2;return v>=0&&v<Dr.length?Dr[v]:v>=0?Dr[v%Dr.length]:"#9CA3AF"},[]),W=t.useCallback((a,x="info")=>{const v=Date.now()+ ++tn.current;ct(k=>[...k,{id:v,message:a,type:x}])},[]),Fr=t.useCallback(a=>{ct(x=>x.filter(v=>v.id!==a))},[]),Cs=t.useCallback(a=>{if(!T.current)return;const x=T.current,v=x.querySelector("img");if(!v)return;const k=v.getBoundingClientRect(),F=x.getBoundingClientRect(),j=8,_=k.width/j,A=k.height/j,M=[];for(let D=0;D<j;D++)for(let P=0;P<j;P++){const Q=(Math.random()-.5)*500,pe=(Math.random()-.5)*500+200,le=(Math.random()-.5)*720,B=k.left-F.left,oe=k.top-F.top;M.push({id:`${D}-${P}`,x:B+P*_,y:oe+D*A,width:_,height:A,tx:Q,ty:pe,rot:le,bgX:-P*_,bgY:-D*A,imgWidth:k.width,imgHeight:k.height})}N(M),Wt(!0),setTimeout(()=>{N([])},800)},[]),ln=t.useCallback(()=>{At.current&&clearTimeout(At.current),Nr(!0),ke.current&&(clearTimeout(ke.current),ke.current=null),Wt(!1),N([]),$e(a=>a===Fe("bear.png")?Fe("sheep.png"):Fe("bear.png")),At.current=setTimeout(()=>{Nr(!1),At.current=null},500)},[]);t.useEffect(()=>{const a=s.pathname==="/history",x=s.pathname==="/ultimate-price-king",v=s.pathname==="/msq-price-checker";if(u||h.length>0||b.length>0||z||a||x||v){ke.current&&(clearTimeout(ke.current),ke.current=null),q.current=0,G.current=3500,Wt(!1),N([]);return}if(kt||Ot){ke.current&&(clearTimeout(ke.current),ke.current=null);return}const k=()=>{if(q.current>=18)return 100;const M=q.current/18,D=3500*Math.pow(100/3500,M*1.15);return Math.max(D,100)},F=()=>{ke.current&&clearTimeout(ke.current);const j=k();G.current=j,ke.current=setTimeout(()=>{const _=s.pathname==="/history",A=s.pathname==="/ultimate-price-king",M=s.pathname==="/msq-price-checker";if(!kt&&!u&&h.length===0&&b.length===0&&!z&&!_&&!A&&!M&&!Ot){q.current++;const D=j<=100,P=Math.max(0,q.current-18);D&&P>=40?(setTimeout(()=>{Cs(dt)},0),setTimeout(()=>{Wt(!1),N([]),q.current=0,G.current=3500,$e(Q=>Q===Fe("bear.png")?Fe("sheep.png"):Fe("bear.png")),setTimeout(()=>{!kt&&!u&&h.length===0&&b.length===0&&!z&&F()},100)},5800)):($e(Q=>Q===Fe("bear.png")?Fe("sheep.png"):Fe("bear.png")),F())}else ke.current=null},j)};return F(),()=>{ke.current&&(clearTimeout(ke.current),ke.current=null)}},[kt,u,h.length,b.length,z,s.pathname,Ot,dt,Cs]),t.useEffect(()=>()=>{ke.current&&(clearTimeout(ke.current),ke.current=null),At.current&&(clearTimeout(At.current),At.current=null)},[]),t.useEffect(()=>{u&&u.name?document.title=`${u.name}-繁中市場`:document.title="FFXIV繁中市場小屋"},[u]),t.useEffect(()=>{if(hr.current)return;rt.current=0,_t.current=!1,hr.current=!1,st.current=0,Lt.current&&Lt.current.abort(),Me.current&&(clearTimeout(Me.current),Me.current=null);const a=async(x=!1)=>{const v=++st.current;x&&Lt.current&&Lt.current.abort(),Lt.current=new AbortController;const k=Lt.current.signal;_t.current=!0,hr.current=!1,Me.current&&(clearTimeout(Me.current),Me.current=null),Me.current=setTimeout(()=>{v===st.current&&_t.current&&!hr.current&&!k.aborted&&rt.current<3&&(rt.current++,_t.current=!1,W(`伺服器加載超時，正在重試 (${rt.current}/3)...`,"warning"),a(!0))},2e3);try{if(k.aborted||v!==st.current)return;const F=await fetch("https://universalis.app/api/v2/data-centers",{signal:k});if(k.aborted||v!==st.current)return;const j=await F.json();if(k.aborted||v!==st.current)return;const _=await fetch("https://universalis.app/api/v2/worlds",{signal:k});if(k.aborted||v!==st.current)return;const A=await _.json();if(k.aborted||v!==st.current)return;if((!j||!Array.isArray(j)||j.length===0||!A||!Array.isArray(A)||A.length===0)&&rt.current<3){rt.current++,_t.current=!1,W(`伺服器資料為空，正在重試 (${rt.current}/3)...`,"warning"),setTimeout(()=>{v===st.current&&a(!0)},2e3);return}const M={};A.forEach(P=>{M[P.id]=P.name}),C(M),Xe(j),er(!0),Je.current||Ve(!1),_t.current=!1,hr.current=!0,Me.current&&(clearTimeout(Me.current),Me.current=null);const D=j.filter(P=>P.region&&P.region.startsWith("繁中服"));if(D.length>0&&D[0].worlds.length>0){const P=D[0],Q=P.worlds[0];O({region:P.region,section:P.name,world:Q,dcObj:P}),te(P.name)}else if(j.length>0){const P=j[0];P.worlds&&P.worlds.length>0&&(O({region:P.region||"",section:P.name,world:P.worlds[0],dcObj:P}),te(P.name))}K(!1),x&&rt.current>0?W("伺服器資料加載成功","success"):W("伺服器資料加載完成","success")}catch(F){if(F.name==="AbortError"||k.aborted||v!==st.current)return;_t.current=!1,Me.current&&(clearTimeout(Me.current),Me.current=null),rt.current<3?(rt.current++,W(`伺服器加載失敗，正在重試 (${rt.current}/3)...`,"warning"),setTimeout(()=>{v===st.current&&a(!0)},2e3)):(console.error("Failed to load data centers/worlds:",F),$("無法加載服務器列表"),W("無法加載服務器列表，請刷新頁面重試","error"),K(!1))}};return a(),()=>{Me.current&&(clearTimeout(Me.current),Me.current=null),Lt.current&&Lt.current.abort()}},[W]),t.useEffect(()=>{Jr().then(a=>{Os(a)})},[]),t.useEffect(()=>{if(!Vt)return;if(!f||!f.dcObj||!me){os({}),dr(!1);return}const a=f.dcObj.worlds||[];if(a.length===0){os({}),dr(!1);return}dr(!0);const x=a.map(async v=>{try{const k=await Bn(v);return{worldId:v,rates:k}}catch(k){return console.error(`Failed to fetch tax rates for world ${v}:`,k),{worldId:v,rates:null}}});Promise.all(x).then(v=>{const k={};v.forEach(({worldId:F,rates:j})=>{j&&(k[F]=j)}),os(k),dr(!1)}).catch(v=>{console.error("Error fetching tax rates:",v),dr(!1)})},[f,me,Vt]),t.useEffect(()=>{Be.current=u},[u]),t.useEffect(()=>{It.current=R?b:h},[h,b,R]),t.useEffect(()=>{const a=Pr.current,x=h.length;a===0&&x>0?R&&L(!1):x===0&&b.length>0&&L(!0),Pr.current=x},[h.length,b.length,R]),t.useEffect(()=>{const a=R?b:h,x=a&&a.length>0&&g&&f;if(Qt.current&&(Qt.current.abort(),Je.current=!1,se&&!x&&Ve(!1)),!a||a.length===0||!g||!f){nr({}),ar({}),or({}),lr({}),Bt({}),ir(!1),se&&!Je.current&&Ve(!1),Je.current=!1,gt.current="";return}return(async()=>{const v=await $r(),F=a.map(Q=>Q.id).sort((Q,pe)=>{const le=v[Q?.toString()]||null,B=v[pe?.toString()]||null;return le!==null&&B!==null?B-le:le!==null?-1:B!==null?1:pe-Q});if(F.length===0){nr({}),ar({}),or({}),lr({}),Bt({}),ir(!1),se&&!Je.current&&Ve(!1),Je.current=!1,gt.current="";return}const j=[...F].sort((Q,pe)=>Q-pe).join(","),_=`${g}`,A=`${j}|${_}`;if(gt.current&&gt.current!==A&&gt.current.split("|")[1]!==_&&(nr({}),ar({}),or({}),lr({}),Bt({})),Je.current||gt.current===A){Je.current&&se&&Ve(!0);return}Je.current=!0,se&&Ve(!0);const M=++mt.current;Qt.current=new AbortController;const D=Qt.current.signal;(async()=>{ir(!0),Ve(!0);try{const Q=g===f.section,pe=Q?f.section:g,le=async(oe,we)=>{if(D.aborted||M!==mt.current)return;let Le;oe===0?Le=20:oe===1?Le=50:Le=100;const at=F.slice(we,we+Le);if(at.length===0)return;const Et=at.join(",");try{const ot=await fetch(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(pe)}/${Et}`,{signal:D});if(D.aborted||M!==mt.current)return;const Ue=await ot.json(),wt={},br={},wr={},Ft={},U={};Ue&&Ue.results&&Ue.results.forEach(V=>{const xt=V.itemId,Mt=(ie,ee,ae)=>{const ye=ie?.world?.[ae],Pe=ee?.world?.[ae],ht=ie?.dc?.[ae],yt=ee?.dc?.[ae],Qe=Q?ht!==void 0?ht:ye:ye!==void 0?ye:void 0,Xt=Q?yt!==void 0?yt:Pe:Pe!==void 0?Pe:void 0;if(ae==="quantity"){if(Qe!==void 0||Xt!==void 0)return(Qe||0)+(Xt||0)}else{if(Qe!==void 0&&Xt!==void 0)return Math.min(Qe,Xt);if(Xt!==void 0)return Xt;if(Qe!==void 0)return Qe}return null},lt=Mt(V.nq?.dailySaleVelocity,V.hq?.dailySaleVelocity,"quantity");let Ge=null;if(Q)Ge=Mt(V.nq?.averageSalePrice,V.hq?.averageSalePrice,"price");else{const ie=V.nq?.averageSalePrice?.world?.price,ee=V.hq?.averageSalePrice?.world?.price,ae=V.nq?.averageSalePrice?.dc?.price,ye=V.hq?.averageSalePrice?.dc?.price,Pe=ie!==void 0?ie:ae,ht=ee!==void 0?ee:ye;Pe!==void 0&&ht!==void 0?Ge=Math.min(Pe,ht):ht!==void 0?Ge=ht:Pe!==void 0&&(Ge=Pe)}const jt=Mt(V.nq?.minListing,V.hq?.minListing,"price"),it=Mt(V.nq?.recentPurchase,V.hq?.recentPurchase,"price");let Ke=null;if(jt!=null)if(Q)Ke=jt;else{const ie=V.nq?.minListing?.world?.price,ee=V.hq?.minListing?.world?.price;let ae=null;if(ie!==void 0&&ee!==void 0?ae=ee<=ie?V.hq?.minListing?.world:V.nq?.minListing?.world:ee!==void 0?ae=V.hq?.minListing?.world:ie!==void 0&&(ae=V.nq?.minListing?.world),ae!==null){const ye=ae?.region;Ke={price:jt},ye!==void 0&&(Ke.region=ye)}}let je=null;if(it!=null)if(Q)je=it;else{const ie=V.nq?.recentPurchase?.world?.price,ee=V.hq?.recentPurchase?.world?.price;let ae=null;if(ie!==void 0&&ee!==void 0?ae=ee<=ie?V.hq?.recentPurchase?.world:V.nq?.recentPurchase?.world:ee!==void 0?ae=V.hq?.recentPurchase?.world:ie!==void 0&&(ae=V.nq?.recentPurchase?.world),ae!==null){const ye=ae?.region;je={price:it},ye!==void 0&&(je.region=ye)}}lt!=null&&(wt[xt]=lt),Ge!=null&&(br[xt]=Math.round(Ge)),Ke!=null&&(wr[xt]=Ke),je!=null&&(Ft[xt]=je),U[xt]=!0}),at.forEach(V=>{U.hasOwnProperty(V)||(U[V]=!1)}),!D.aborted&&M===mt.current&&(Wr.flushSync(()=>{nr(V=>({...V,...wt})),ar(V=>({...V,...br})),or(V=>({...V,...wr})),lr(V=>({...V,...Ft})),Bt(V=>({...V,...U}))}),oe===0&&ir(!1))}catch(ot){if(ot.name==="AbortError"||D.aborted)return;console.error("Error fetching market data:",ot);const Ue={};at.forEach(wt=>{Ue[wt]=!1}),!D.aborted&&M===mt.current&&Wr.flushSync(()=>{Bt(wt=>({...wt,...Ue}))})}},B=async(oe,we)=>{if(D.aborted||M!==mt.current||we>=F.length)return;let Le;if(oe===0?Le=20:oe===1?Le=50:Le=100,await le(oe,we),D.aborted||M!==mt.current)return;const at=we+Le;at<F.length&&await new Promise(Et=>{setTimeout(()=>{B(oe+1,at).then(Et)},oe===0?0:100)})};await B(0,0),!D.aborted&&M===mt.current?(Je.current=!1,se&&Ve(!1),gt.current=A):Je.current=!1}catch(Q){if(Q.name==="AbortError"||D.aborted)return;console.error("Error fetching velocities, average prices, and tradability:",Q),M===mt.current&&(Je.current=!1,se&&Ve(!1),gt.current="")}finally{M!==mt.current&&ir(!1)}})()})(),()=>{Qt.current&&Qt.current.abort()}},[h,b,g,f,se]),t.useEffect(()=>{const a=s.pathname==="/search";return a||ms(),()=>{a||ms()}},[s.pathname]),t.useEffect(()=>{const a=s.pathname==="/history";if(!a||u){a||(ur({}),mr({}),fr({}),xr({}),zt({}),Ut(!1),vt.current=!1,bt.current="");return}if(Yt.current&&(Yt.current.abort(),vt.current=!1),!$t||$t.length===0||!g||!f){ur({}),mr({}),fr({}),xr({}),zt({}),Ut(!1),vt.current=!1,bt.current="";return}return(async()=>{const x=await $r(),k=$t.map(P=>P.id).sort((P,Q)=>{const pe=x[P?.toString()]||null,le=x[Q?.toString()]||null;return pe!==null&&le!==null?le-pe:pe!==null?-1:le!==null?1:Q-P});if(k.length===0){ur({}),mr({}),fr({}),xr({}),zt({}),Ut(!1),vt.current=!1,bt.current="";return}const F=[...k].sort((P,Q)=>P-Q).join(","),j=`${g}`,_=`${F}|${j}`;if(bt.current&&bt.current!==_&&bt.current.split("|")[1]!==j&&(ur({}),mr({}),fr({}),xr({}),zt({})),vt.current||bt.current===_)return;vt.current=!0;const A=++ft.current;Yt.current=new AbortController;const M=Yt.current.signal;(async()=>{Ut(!0);try{const P=g===f.section,Q=P?f.section:g,pe=async(B,oe)=>{if(M.aborted||A!==ft.current)return;let we;B===0?we=20:B===1?we=50:we=100;const Le=k.slice(oe,oe+we);if(Le.length===0)return;const at=Le.join(",");try{const Et=await fetch(`https://universalis.app/api/v2/aggregated/${encodeURIComponent(Q)}/${at}`,{signal:M});if(M.aborted||A!==ft.current)return;const ot=await Et.json(),Ue={},wt={},br={},wr={},Ft={};ot&&ot.results&&ot.results.forEach(U=>{const V=U.itemId,xt=(je,ie,ee)=>{const ae=je?.world?.[ee],ye=ie?.world?.[ee],Pe=je?.dc?.[ee],ht=ie?.dc?.[ee],yt=P?Pe!==void 0?Pe:ae:ae!==void 0?ae:void 0,Qe=P?ht!==void 0?ht:ye:ye!==void 0?ye:void 0;if(ee==="quantity"){if(yt!==void 0||Qe!==void 0)return(yt||0)+(Qe||0)}else{if(yt!==void 0&&Qe!==void 0)return Math.min(yt,Qe);if(Qe!==void 0)return Qe;if(yt!==void 0)return yt}return null},Mt=xt(U.nq?.dailySaleVelocity,U.hq?.dailySaleVelocity,"quantity");let lt=null;if(P)lt=xt(U.nq?.averageSalePrice,U.hq?.averageSalePrice,"price");else{const je=U.nq?.averageSalePrice?.world?.price,ie=U.hq?.averageSalePrice?.world?.price,ee=U.nq?.averageSalePrice?.dc?.price,ae=U.hq?.averageSalePrice?.dc?.price,ye=je!==void 0?je:ee,Pe=ie!==void 0?ie:ae;ye!==void 0&&Pe!==void 0?lt=Math.min(ye,Pe):Pe!==void 0?lt=Pe:ye!==void 0&&(lt=ye)}const Ge=xt(U.nq?.minListing,U.hq?.minListing,"price"),jt=xt(U.nq?.recentPurchase,U.hq?.recentPurchase,"price");let it=null;if(Ge!=null)if(P)it=Ge;else{const je=U.nq?.minListing?.world?.price,ie=U.hq?.minListing?.world?.price;let ee=null;if(je!==void 0&&ie!==void 0?ee=ie<=je?U.hq?.minListing?.world:U.nq?.minListing?.world:ie!==void 0?ee=U.hq?.minListing?.world:je!==void 0&&(ee=U.nq?.minListing?.world),ee!==null){const ae=ee?.region;it={price:Ge},ae!==void 0&&(it.region=ae)}}let Ke=null;if(jt!=null)if(P)Ke=jt;else{const je=U.nq?.recentPurchase?.world?.price,ie=U.hq?.recentPurchase?.world?.price;let ee=null;if(je!==void 0&&ie!==void 0?ee=ie<=je?U.hq?.recentPurchase?.world:U.nq?.recentPurchase?.world:ie!==void 0?ee=U.hq?.recentPurchase?.world:je!==void 0&&(ee=U.nq?.recentPurchase?.world),ee!==null){const ae=ee?.region;Ke={price:jt},ae!==void 0&&(Ke.region=ae)}}Mt!=null&&(Ue[V]=Mt),lt!=null&&(wt[V]=Math.round(lt)),it!=null&&(br[V]=it),Ke!=null&&(wr[V]=Ke),Ft[V]=!0}),Le.forEach(U=>{Ft.hasOwnProperty(U)||(Ft[U]=!1)}),!M.aborted&&A===ft.current&&(Wr.flushSync(()=>{ur(U=>({...U,...Ue})),mr(U=>({...U,...wt})),fr(U=>({...U,...br})),xr(U=>({...U,...wr})),zt(U=>({...U,...Ft}))}),B===0&&Ut(!1))}catch(Et){if(Et.name==="AbortError"||M.aborted)return;console.error("Error fetching history market data:",Et);const ot={};Le.forEach(Ue=>{ot[Ue]=!1}),!M.aborted&&A===ft.current&&Wr.flushSync(()=>{zt(Ue=>({...Ue,...ot}))})}},le=async(B,oe)=>{if(M.aborted||A!==ft.current||oe>=k.length)return;let we;if(B===0?we=20:B===1?we=50:we=100,await pe(B,oe),M.aborted||A!==ft.current)return;const Le=oe+we;Le<k.length&&await new Promise(at=>{setTimeout(()=>{le(B+1,Le).then(at)},B===0?0:100)})};await le(0,0),!M.aborted&&A===ft.current?(vt.current=!1,bt.current=_):vt.current=!1}catch(P){if(P.name==="AbortError"||M.aborted)return;console.error("Error fetching history velocities:",P),A===ft.current&&(vt.current=!1,bt.current="")}finally{A!==ft.current&&Ut(!1)}})()})(),()=>{Yt.current&&Yt.current.abort()}},[$t,g,f,se,s.pathname,u]),t.useEffect(()=>{if(pt&&((R?b:h).length>=50||h.length>=50||b.length>=50))Ht.current||(Ht.current=Date.now()),cr(!0);else if(Ht.current){const v=Date.now()-Ht.current,k=Math.max(0,1e3-v);if(k>0){const F=setTimeout(()=>{cr(!1),Ht.current=null},k);return()=>clearTimeout(F)}else cr(!1),Ht.current=null}else cr(!1)},[pt,R,h.length,b.length]),t.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"}),document.documentElement.scrollTop=0,document.body.scrollTop=0},[s.pathname,s.search]);const He=t.useCallback(async a=>{m(null),E([]),S([]),$(null),fe(null),i(""),(s.pathname==="/search"||n.get("q"))&&(sr(!1),Tr.current=!0),he.current&&(clearTimeout(he.current),he.current=null),Ne.current&&Ne.current.abort(),et.current=0,Rt.current=!1,tt.current=!1,ge(!0);try{const v=await Es(a.id);Ae(v)}catch(v){console.error("Failed to check if item is craftable:",v),Ae(!1)}I(a),Be.current=a,us(a.id),r(`/item/${a.id}`,{replace:!1}),W(`已選擇: ${a.name}`,"info")},[W,r,s.pathname,n]);t.useEffect(()=>{let a=o.id;if(!a&&s.pathname.startsWith("/item/")){const j=s.pathname.match(/^\/item\/(\d+)$/);j&&(a=j[1])}if(a&&!se){qe(!0);return}if(!se||Kt.current)return;const x=`${s.pathname}?${s.search}`;if(De.current===x)return;Kt.current=!0,Tt&&qe(!1);const v=n.get("server"),k=n.get("world");if(n.get("dc"),v&&se&&(Ye.some(_=>_.name===v)||k&&me[v])&&(te(v),k)){const _=Object.values(me).find(A=>A&&A.name===k);_&&O(_)}if(s.pathname==="/history"){I(null),Be.current=null,De.current=x,Kt.current=!1;return}if(s.pathname==="/msq-price-checker"){De.current=x,Kt.current=!1;return}if(s.pathname==="/ultimate-price-king"){De.current=x,Kt.current=!1;return}if(a){const j=parseInt(a,10);if(j&&!isNaN(j)){const _=Be.current;if(!_||_.id!==j){Tr.current&&(sr(!1),Tr.current=!1);const A=It.current.find(M=>M.id===j);A?(I(A),Be.current=A):(qe(!0),_s(j).then(M=>{if(De.current!==x){qe(!1);return}M?(I(M),Be.current=M,qe(!1)):(qe(!1),W("找不到該物品","error"),r("/"))}).catch(M=>{qe(!1),De.current===x&&(console.error("Failed to load item:",M),W("載入物品失敗","error"),r("/"))}))}}}const F=n.get("q");if(F&&F.trim()!==""){if(Tr.current=!0,!a){I(null),Be.current=null,m(null),E([]),S([]),fe(null);const j=d;d!==F&&i(F),(h.length===0&&b.length===0||j!==F)&&!nt.current&&(nt.current=!0,(async()=>{if(De.current!==x){nt.current=!1;return}if(Y||!se){nt.current=!1;return}if(!Br(F.trim())){nt.current=!1;return}H(!0),Ve(!0),$(null);try{const M=await Ms(F.trim()),{results:D,converted:P,originalText:Q,convertedText:pe}=M;if(De.current!==x){nt.current=!1;return}if(P&&pe&&W(`「${Q}」無搜尋結果，正在嘗試轉譯成「${pe}」`,"info"),p([]),L(!1),c(D),It.current=D,$(null),Pr.current=0,Jr().then(le=>{if(De.current===x){const B=D.filter(we=>le.has(we.id)),oe=D.filter(we=>!le.has(we.id));B.length>0?(L(!1),c(B),p(oe)):(L(B.length===0&&oe.length>0),c(B),p(oe)),It.current=B.length>0?B:oe,D.length>1&&j!==F&&W(`找到 ${B.length} 個可交易物品${oe.length>0?`、${oe.length} 個不可交易物品`:""}`,"success")}}).catch(le=>{console.error("Error verifying tradeability:",le),De.current===x&&D.length>1&&j!==F&&W(`找到 ${D.length} 個物品`,"success")}),D.length===0)W("未找到相關物品","warning"),De.current===x&&Ve(!1);else if(D.length===1){const le=D[0];sr(!1),I(le),Be.current=le,us(le.id),r(`/item/${le.id}`,{replace:!0}),W(`已選擇: ${le.name}`,"info")}}catch(M){if(De.current!==x){nt.current=!1;return}console.error("Search error:",M),$("搜索失敗，請稍後再試"),c([]),p([]),L(!1),It.current=[],W("搜索失敗","error"),De.current===x&&Ve(!1)}finally{De.current===x&&H(!1),nt.current=!1}})())}}else if(!a&&s.pathname==="/"){const j=Be.current,_=It.current;(j||_.length>0||d)&&(I(null),Be.current=null,c([]),p([]),L(!1),It.current=[],i(""),m(null),E([]),S([]))}De.current=x,Kt.current=!1},[s.pathname,s.search,se,o.id,n,d,r,W,Y,Ye,me,He,Br]),t.useCallback(()=>{I(null),Be.current=null,c([]),p([]),L(!1),It.current=[],i(""),m(null),E([]),S([]),$(null),fe(null),he.current&&(clearTimeout(he.current),he.current=null),Ne.current&&Ne.current.abort(),et.current=0,Rt.current=!1,tt.current=!1,r("/",{replace:!1})},[r]);const vr=t.useCallback(async(a,x=!1)=>{const v=a?a.trim():"";if(nt.current)return;let k=o.id;if(!k&&s.pathname.startsWith("/item/")){const F=s.pathname.match(/^\/item\/(\d+)$/);F&&(k=F[1])}if(!v){Mr.current="",c([]),p([]),L(!1),Be.current||(I(null),m(null),E([]),S([]),$(null),fe(null),!x&&!k&&s.pathname!=="/ultimate-price-king"&&s.pathname!=="/msq-price-checker"&&s.pathname!=="/advanced-search"&&s.pathname!=="/history"&&r("/"));return}if(Y||!se){W("請等待伺服器資料加載完成","warning");return}if(!Br(v)){W("請輸入中文進行搜索","warning"),c([]),p([]),L(!1),I(null),m(null),E([]),S([]),$(null),fe(null);return}nt.current=!0,v&&(Mr.current=v),H(!0),$(null),I(null),Be.current=null,m(null),E([]),S([]),fe(null),ms(),nr({}),ar({}),or({}),lr({}),Bt({}),gt.current="",!x&&v&&r(`/search?q=${encodeURIComponent(v)}`,{replace:!1});try{const F=await Ms(v),{results:j,converted:_,originalText:A,convertedText:M}=F;if(_&&M&&W(`「${A}」無搜尋結果，正在嘗試轉譯成「${M}」`,"info"),p([]),L(!1),c(j),Rr(1),$(null),Pr.current=0,Jr().then(D=>{const P=j.filter(pe=>D.has(pe.id)),Q=j.filter(pe=>!D.has(pe.id));P.length>0?(L(!1),c(P),p(Q)):(L(P.length===0&&Q.length>0),c(P),p(Q)),j.length>1&&W(`找到 ${P.length} 個可交易物品${Q.length>0?`、${Q.length} 個不可交易物品`:""}`,"success")}).catch(D=>{console.error("Error verifying tradeability:",D),j.length>1&&W(`找到 ${j.length} 個物品`,"success")}),j.length===0)W("未找到相關物品","warning");else if(v&&jn(v),j.length===1){const D=j[0];sr(!1),I(D),Be.current=D,us(D.id),r(`/item/${D.id}`,{replace:!0}),W(`已選擇: ${D.name}`,"info")}}catch(F){$(F.message||"搜索失敗，請稍後再試"),W("搜索失敗","error"),c([]),p([]),L(!1)}finally{H(!1),nt.current=!1,setTimeout(()=>{Mr.current===v&&(Mr.current="")},1e3)}},[W,Y,g,Br,He,o.id,s.pathname,r]),Dt=t.useCallback(a=>{te(a),Ve(!0)},[]);t.useEffect(()=>{if(Y||!u||!g){m(null),E([]),S([]);return}m(null),E([]),S([]),$(null),fe(null),Ne.current&&Ne.current.abort(),he.current&&(clearTimeout(he.current),he.current=null),Ne.current=new AbortController;const a=++Ct.current,x=u.id,v=u.name,k=g;et.current=0,Rt.current=!1,tt.current=!1,he.current&&(clearTimeout(he.current),he.current=null);const F=async(j=!1)=>{if(j&&Ne.current){Ne.current.abort();const _=new AbortController;Ne.current=_}ge(!0),$(null),fe(null),tt.current=!0,Rt.current=!1,he.current&&(clearTimeout(he.current),he.current=null),he.current=setTimeout(()=>{tt.current&&!Rt.current&&et.current<3&&a===Ct.current&&!Ne.current?.signal.aborted&&u?.id===x&&g===k&&(et.current++,tt.current=!1,W(`請求超時，正在重試 (${et.current}/3)...`,"warning"),F(!0))},1500);try{if(!await On(x)){Rt.current=!0,tt.current=!1,m(null),E([]),S([]),$("此物品無法在市場板交易");return}const A={listings:ce,entries:ce,signal:Ne.current.signal};u.canBeHQ&&Ze&&(A.hq=!0);const M=await Wn(k,x,A);if(Ne.current?.signal.aborted||a!==Ct.current||u?.id!==x||g!==k){tt.current=!1;return}if(Rt.current=!0,tt.current=!1,he.current&&(clearTimeout(he.current),he.current=null),m(M),!M){E([]),S([]),$("此物品在市場數據中不存在，可能無法在市場板交易");return}if(M){const D=f&&k===f.section,Q=(M.listings||[]).map(B=>({itemName:v,pricePerUnit:B.pricePerUnit,quantity:B.quantity,total:B.total,retainerName:B.retainerName,worldName:B.worldName||(D?M.dcName||k:M.worldName||k),hq:B.hq||!1})).sort((B,oe)=>B.pricePerUnit-oe.pricePerUnit).slice(0,ce),le=(M.recentHistory||[]).map(B=>({itemName:v,pricePerUnit:B.pricePerUnit,quantity:B.quantity,total:B.total,buyerName:B.buyerName,worldName:B.worldName||(D?M.dcName||k:M.worldName||k),timestamp:B.timestamp,hq:B.hq||!1})).sort((B,oe)=>oe.timestamp-B.timestamp).slice(0,ce);a===Ct.current&&!Ne.current?.signal.aborted&&u?.id===x&&g===k&&(E(Q),S(le),j&&et.current>0&&W("數據加載成功","success"))}}catch(_){if(tt.current=!1,_.name==="AbortError"||_.code==="ERR_CANCELED"||Ne.current?.signal.aborted)return;if(a===Ct.current&&u?.id===x&&g===k)if(_.message&&_.message.includes("請求頻率過高"))fe("請求頻率過高，請稍後再試"),W("請求頻率過高，請稍後再試","warning"),setTimeout(()=>{a===Ct.current&&!Ne.current?.signal.aborted&&u?.id===x&&g===k&&Ie(A=>A+1)},3e3);else{if(_.response?.status===404){$("此物品在市場數據中不存在，可能無法在市場板交易"),W("此物品在市場數據中不存在","warning");return}et.current<3?(et.current++,W(`請求失敗，正在重試 (${et.current}/3)...`,"warning"),setTimeout(()=>{a===Ct.current&&!Ne.current?.signal.aborted&&u?.id===x&&g===k&&F(!0)},500)):($(_.message),W("加載市場數據失敗","error"))}}finally{a===Ct.current&&(Rt.current||et.current>=3||!tt.current)&&ge(!1)}};return F(),()=>{Ne.current&&Ne.current.abort(),he.current&&(clearTimeout(he.current),he.current=null)}},[Y,u,g,ce,Ze,ve,W,f]),t.useEffect(()=>{if(!u){pr.current&&(pr.current=null);return}const a=new AbortController;return pr.current=a,Hr(u.id,a.signal).then(x=>{a.signal.aborted}).catch(x=>{x.name!=="AbortError"&&console.error("Failed to pre-fetch Simplified Chinese name:",x)}),()=>{pr.current===a&&(pr.current=null)}},[u]),t.useEffect(()=>{if(!u){J(null),_e(!1),Se(!1),ss(!1),kr(!1),Ae(!1);return}be(!1),J(null),Se(!1),Es(u.id).then(a=>{_e(a),a&&Oe&&(Se(!0),Ae(!1))}).catch(a=>{console.error("Failed to check crafting recipe:",a),_e(!1),J(null),Ae(!1)}),ns(!0),kr(!1),hn(u.id).then(a=>{ss(a.length>0),ns(!1)}).catch(a=>{console.error("Failed to check related items:",a),ss(!1),ns(!1)})},[u,Ee,Oe]),t.useEffect(()=>{if(!u||!Z||!xe){!xe&&ne&&J(null);return}ne||(be(!0),Ps(u.id,1,new Set,0,Ee).then(a=>{J(a),be(!1)}).catch(a=>{console.error("Failed to build crafting tree:",a),be(!1)}))},[xe,u,Z,Ee,ne]),t.useEffect(()=>{!u||!Z||!xe||!ne||(be(!0),Ps(u.id,1,new Set,0,Ee).then(a=>{J(a),be(!1)}).catch(a=>{console.error("Failed to rebuild crafting tree:",a),be(!1)}))},[Ee]);const cn=t.useCallback(a=>{qt(a),localStorage.setItem("craftingTreeExcludeCrystals",a.toString())},[]);t.useEffect(()=>{if(!u){ys(!1);return}const a=()=>{const x=window.scrollY||document.documentElement.scrollTop;ys(x>300)};return window.addEventListener("scroll",a),a(),()=>{window.removeEventListener("scroll",a)}},[u]);const dn=t.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),ds=f?[f.section,...f.dcObj.worlds]:[],Or=s.pathname==="/history",Rs=s.pathname==="/ultimate-price-king",Ls=s.pathname==="/msq-price-checker",Is=s.pathname==="/advanced-search";return(()=>{const a=s.pathname;return a==="/"||a==="/history"||a==="/ultimate-price-king"||a==="/msq-price-checker"||a==="/advanced-search"||a==="/search"?!0:a.startsWith("/item/")?a.match(/^\/item\/(\d+)$/)!==null:!1})()?Is?e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold"})}),children:e.jsx(Qn,{addToast:W,removeToast:Fr,toasts:Nt,datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:f&&f.dcObj?[f.section,...f.dcObj.worlds]:[],isServerDataLoaded:se,onItemSelect:He,onSearch:vr,searchText:d,setSearchText:i,isSearching:z,onTaxRatesClick:()=>{St(!0)},isTaxRatesModalOpen:Vt,setIsTaxRatesModalOpen:St,taxRates:Lr,isLoadingTaxRates:Ir})}):Ls?e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold"})}),children:e.jsx(Kn,{addToast:W,removeToast:Fr,toasts:Nt,datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:f&&f.dcObj?[f.section,...f.dcObj.worlds]:[],isServerDataLoaded:se,onItemSelect:He,onSearch:vr,searchText:d,setSearchText:i,isSearching:z,onTaxRatesClick:()=>{St(!0)},isTaxRatesModalOpen:Vt,setIsTaxRatesModalOpen:St,taxRates:Lr,isLoadingTaxRates:Ir})}):Rs?e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold"})}),children:e.jsx(Un,{addToast:W,removeToast:Fr,toasts:Nt,datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:f&&f.dcObj?[f.section,...f.dcObj.worlds]:[],onSearch:vr,searchText:d,setSearchText:i,isSearching:z,isServerDataLoaded:se,onItemSelect:He,onTaxRatesClick:()=>{St(!0)},isTaxRatesModalOpen:Vt,setIsTaxRatesModalOpen:St,taxRates:Lr,isLoadingTaxRates:Ir})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 via-purple-950/30 to-slate-950 text-white",children:[e.jsx(Hn,{onSearch:vr,isSearching:z,searchText:d,setSearchText:i,isServerDataLoaded:se,selectedDcName:f?.section,onItemSelect:He,selectedItem:u,getSimplifiedChineseName:Hr,addToast:W,showNavigationButtons:!0,onUltimatePriceKingClick:()=>{i(""),r("/ultimate-price-king")},activePage:Rs?"ultimate-price-king":Ls?"msq-price-checker":Is?"advanced-search":null,onMSQPriceCheckerClick:()=>{i(""),r("/msq-price-checker")},onAdvancedSearchClick:()=>{i(""),r("/advanced-search")},onTaxRatesClick:()=>{St(!0)},searchResults:R?b:h,marketableItems:Cr}),e.jsx("div",{className:`fixed right-2 mid:right-4 left-2 mid:left-auto z-50 space-y-2 max-w-sm mid:max-w-none ${u?"top-[100px] mid:top-[120px] detail:top-24":"top-[60px] mid:top-4"}`,children:Nt.map(a=>e.jsx(Dn,{message:a.message,type:a.type,onClose:()=>Fr(a.id)},a.id))}),Y&&e.jsx("div",{className:"fixed top-14 mid:top-4 left-1/2 transform -translate-x-1/2 z-[60]",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-900/80 to-indigo-900/80 backdrop-blur-sm px-3 mid:px-4 py-2 rounded-lg border border-ffxiv-gold/30 flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-ffxiv-gold"}),e.jsx("span",{className:"text-xs mid:text-sm text-gray-300",children:"正在載入伺服器..."})]})}),e.jsx("div",{className:`pb-8 ${u?"pt-[200px] md:pt-[180px] lg:pt-[160px] xl:pt-24":"pt-16 mid:pt-24"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-4",children:[Or&&!u&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-ffxiv-gold flex items-center gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 sm:h-8 sm:w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"歷史記錄"]})}),e.jsxs("button",{onClick:()=>{window.confirm("確定要清空所有歷史記錄嗎？")&&Ys()},className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium bg-red-800/60 hover:bg-red-700/70 text-gray-200 hover:text-white rounded-md border border-red-500/40 hover:border-red-400/60 transition-all duration-200 flex items-center gap-2",title:"清空歷史記錄",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"清空歷史記錄"})]})]}),Qs?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ffxiv-gold mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"載入歷史記錄..."})]}):$t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm sm:text-base text-gray-400 mb-4",children:["共 ",$t.length," 個物品"]}),f&&e.jsxs("div",{className:"mb-4 flex items-center gap-3 flex-wrap",children:[e.jsx("label",{className:"text-sm font-semibold text-ffxiv-gold whitespace-nowrap",children:"伺服器選擇:"}),e.jsx(fs,{datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:ds,disabled:Ns})]}),e.jsx(qs,{items:$t,onSelect:He,selectedItem:u,marketableItems:Cr,itemVelocities:Xs,itemAveragePrices:Js,itemMinListings:Gs,itemRecentPurchases:Zs,itemTradability:en,isLoadingVelocities:Ns,averagePriceHeader:g===f?.section?"全服平均價格":"平均價格",getSimplifiedChineseName:Hr,addToast:W})]}):e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📜"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-ffxiv-gold mb-2",children:"暫無歷史記錄"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-400",children:"查看物品詳情後，會自動保存到歷史記錄"})]})]}),!Or&&(h.length>0||b.length>0)&&!u&&(()=>{const a=R?b:h;let x=a;Cr&&a.some(_=>as?.[_.id]===!0)&&(x=a.filter(_=>as?.[_.id]===!0));const v=Math.ceil(a.length/We),k=(ze-1)*We,F=k+We;return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold",children:["搜索結果 (",a.length," 個物品",x.length!==a.length?`，顯示 ${x.length} 個`:"",")"]}),f&&g&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-purple-900/40 via-pink-900/30 to-indigo-900/40 border border-purple-500/30 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-ffxiv-gold animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-ffxiv-gold",children:g===f.section?`${f.section} (全服)`:me[g]||`伺服器 ${g}`})]}),b.length>0&&h.length>0&&!pt&&e.jsx("button",{onClick:()=>{L(!R),Rr(1)},className:`px-3 py-1.5 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 backdrop-blur-sm shadow-sm ${R?"bg-gradient-to-r from-slate-700/70 via-slate-600/60 to-slate-700/70 text-gray-200 border border-slate-500/50 hover:from-slate-600/80 hover:via-slate-500/70 hover:to-slate-600/80 hover:border-slate-400/60 hover:shadow-md":"bg-gradient-to-r from-slate-800/70 via-slate-700/60 to-slate-800/70 text-gray-300 border border-slate-600/50 hover:from-slate-700/80 hover:via-slate-600/70 hover:to-slate-700/80 hover:border-slate-500/60 hover:shadow-md hover:text-gray-200"}`,children:R?"隱藏不可交易物品":`顯示不可以交易物品${b.length}個`}),Ks&&a.length>=50&&e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-slate-800/50 border border-purple-500/30 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-ffxiv-gold"}),e.jsx("span",{className:"text-xs text-gray-300",children:"載入中"})]})]}),a.length>100&&e.jsx("div",{className:`mb-4 p-4 rounded-lg border-2 ${a.length>200?"bg-red-900/40 border-red-500/50":"bg-yellow-900/40 border-yellow-500/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl flex-shrink-0",children:"⚠️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold mb-1 ${a.length>200?"text-red-400":"text-yellow-400"}`,children:a.length>200?"結果數量過多":"結果數量較多"}),e.jsxs("p",{className:"text-sm text-gray-300",children:["找到 ",e.jsx("span",{className:`font-bold ${a.length>200?"text-red-400":"text-yellow-400"}`,children:a.length})," 個物品。 數據載入需要一些時間，排序可能會較慢。 建議使用更嚴格的關鍵詞進行搜索，或請耐心等待。"]})]})]})}),f&&e.jsxs("div",{className:"mb-4 flex items-center gap-3 flex-wrap",children:[e.jsx("label",{className:"text-sm font-semibold text-ffxiv-gold whitespace-nowrap",children:"伺服器選擇:"}),e.jsx(fs,{datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:ds,disabled:pt})]}),a.length>We&&e.jsxs("div",{className:"mb-4 flex items-center justify-between flex-wrap gap-3 bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-300",children:"每頁顯示:"}),e.jsxs("select",{value:We,onChange:j=>{const _=parseInt(j.target.value,10);Us(_),Rr(1)},className:"px-3 py-1.5 bg-slate-900/50 border border-purple-500/30 rounded-lg text-white text-sm focus:outline-none focus:border-ffxiv-gold",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:200,children:"200"})]}),e.jsxs("span",{className:"text-sm text-gray-400",children:["顯示 ",k+1,"-",Math.min(F,a.length)," / ",a.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const _=0*We,A=1*We;if(x.slice(_,A).length===0&&pt){W("該頁面資料正在載入中，請稍候...","warning");return}Er(1)},disabled:ze===1,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${ze===1?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-slate-800/50 text-white hover:bg-purple-800/40 border border-purple-500/30"}`,children:"首頁"}),e.jsx("button",{onClick:()=>{const j=ze-1,_=(j-1)*We,A=j*We;if(x.slice(_,A).length===0&&pt){W("該頁面資料正在載入中，請稍候...","warning");return}Er(j)},disabled:ze===1,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${ze===1?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-slate-800/50 text-white hover:bg-purple-800/40 border border-purple-500/30"}`,children:"上一頁"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-gray-300",children:["第 ",ze," / ",v," 頁"]}),e.jsx("button",{onClick:()=>{const j=ze+1,_=(j-1)*We,A=j*We;if(x.slice(_,A).length===0&&pt){W("該頁面資料正在載入中，請稍候...","warning");return}Er(j)},disabled:ze===v,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${ze===v?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-slate-800/50 text-white hover:bg-purple-800/40 border border-purple-500/30"}`,children:"下一頁"}),e.jsx("button",{onClick:()=>{const j=v,_=(j-1)*We,A=j*We;if(x.slice(_,A).length===0&&pt){W("該頁面資料正在載入中，請稍候...","warning");return}Er(j)},disabled:ze===v,className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${ze===v?"bg-slate-700/50 text-gray-500 cursor-not-allowed opacity-50":"bg-slate-800/50 text-white hover:bg-purple-800/40 border border-purple-500/30"}`,children:"末頁"})]})]}),e.jsx(qs,{items:a,onSelect:He,selectedItem:u,marketableItems:Cr,itemVelocities:Ws,itemAveragePrices:Bs,itemMinListings:Hs,itemRecentPurchases:Vs,itemTradability:as,isLoadingVelocities:zs,averagePriceHeader:g===f?.section?"全服平均價格":"平均價格",currentPage:ze,itemsPerPage:We,isRaritySelectorDisabled:pt,getSimplifiedChineseName:Hr,addToast:W})]})})(),u&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-lg border border-slate-700/50 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col detail:flex-row detail:items-center detail:justify-between gap-4 detail:gap-4 mb-3 mid:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mid:gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ts,{itemId:u.id,alt:u.name,className:"w-16 h-16 mid:w-20 mid:h-20 object-contain rounded-lg border-2 border-ffxiv-gold/30 bg-slate-900/50 p-2 shadow-lg"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 mid:gap-2 flex-wrap",children:[e.jsx("h2",{className:"text-lg mid:text-xl font-bold text-ffxiv-gold break-words line-clamp-2",children:u.name}),e.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(u.name),W("已複製物品名稱","success")}catch(a){console.error("Failed to copy:",a),W("複製失敗","error")}},className:"flex-shrink-0 p-1 mid:p-1.5 text-gray-400 hover:text-ffxiv-gold hover:bg-purple-800/40 rounded-md border border-transparent hover:border-purple-500/40 transition-all duration-200",title:"複製物品名稱",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mid:h-4 mid:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),e.jsx("div",{className:"flex items-center gap-3 mid:gap-4 mt-1 flex-wrap",children:(()=>{const a=an(u.id),x=on(u.id);return e.jsxs(e.Fragment,{children:[x&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md border text-xs mid:text-sm font-bold whitespace-nowrap",style:{background:`linear-gradient(135deg, ${gr(x)}20 0%, ${gr(x)}10 100%)`,borderColor:`${gr(x)}50`,color:gr(x),boxShadow:`0 1px 3px ${gr(x)}20`},children:["版本: ",x]}),a!==null&&e.jsxs("span",{className:"text-xs mid:text-sm text-green-400 font-semibold",children:["ilvl: ",a]})]})})()})]})]}),e.jsx("div",{className:"flex items-center gap-3 detail:gap-4 overflow-x-auto min-w-0 detail:flex-shrink-0 detail:max-w-none relative z-10 scroll-pl-1 -ml-1 pl-1",children:e.jsx(fs,{datacenters:Ye,worlds:me,selectedWorld:f,onWorldChange:O,selectedServerOption:g,onServerOptionChange:Dt,serverOptions:ds})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 pt-3 border-t border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("label",{className:"text-xs sm:text-sm text-gray-400 whitespace-nowrap",children:"數量:"}),e.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:ce,onChange:a=>re(parseInt(a.target.value,10)),className:"flex-1 sm:w-32 h-1.5 bg-purple-800/50 rounded-lg appearance-none cursor-pointer accent-ffxiv-gold"}),e.jsx("span",{className:"text-xs sm:text-sm text-ffxiv-gold w-8 sm:w-10 font-medium text-right",children:ce})]}),u.canBeHQ&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:Ze,onChange:a=>Zt(a.target.checked),className:"sr-only"}),e.jsx("div",{className:`
                          w-10 h-6 rounded-full transition-all duration-300 ease-in-out
                          ${Ze?"bg-gradient-to-r from-ffxiv-gold to-yellow-500 shadow-[0_0_15px_rgba(212,175,55,0.5)]":"bg-purple-800/50 border-2 border-purple-600/50"}
                          group-hover:scale-105
                        `,children:e.jsx("div",{className:`
                            absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white transition-all duration-300 ease-in-out
                            ${Ze?"translate-x-4":"translate-x-0"}
                            shadow-md
                          `,children:Ze&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-ffxiv-gold",children:"★"})})})})]}),e.jsx("span",{className:`
                        text-xs sm:text-sm font-semibold transition-colors duration-200
                        ${Ze?"text-ffxiv-gold":"text-gray-400 group-hover:text-gray-300"}
                      `,children:"HQ"})]}),e.jsxs("button",{onClick:()=>t.startTransition(()=>sr(!rr)),className:`
                      flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl transition-all duration-300
                      ${rr?"bg-gradient-to-r from-amber-900/60 via-yellow-800/50 to-orange-900/60 border border-ffxiv-gold/60 text-ffxiv-gold":"bg-gradient-to-r from-purple-900/50 via-indigo-900/40 to-purple-900/50 border border-purple-400/40 text-purple-200 hover:text-ffxiv-gold hover:border-ffxiv-gold/50"}
                    `,title:rr?"收起取得方式":"展開取得方式",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 sm:h-5 sm:w-5 transition-transform duration-300 ${rr?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap tracking-wide",children:"取得方式"})]}),e.jsxs("button",{onClick:()=>Se(!xe),disabled:!Z||Ce,className:`
                      relative flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl transition-all duration-300 overflow-hidden
                      ${Z&&!Ce?xe?"bg-gradient-to-r from-amber-900/60 via-yellow-800/50 to-orange-900/60 border border-ffxiv-gold/60 text-ffxiv-gold shadow-[0_0_20px_rgba(212,175,55,0.4)]":"bg-gradient-to-r from-purple-900/50 via-indigo-900/40 to-purple-900/50 border border-purple-400/40 text-purple-200 hover:text-ffxiv-gold hover:border-ffxiv-gold/50 hover:shadow-[0_0_15px_rgba(212,175,55,0.2)] animate-[craftingPulse_3s_ease-in-out_infinite]":"bg-slate-800/30 border border-slate-600/20 text-gray-600 cursor-not-allowed"}
                    `,title:Ce?"載入配方中...":Z?xe?"收起製作價格樹":"展開製作價格樹":"此物品無製作配方",children:[Z&&!Ce&&!xe&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_3s_ease-in-out_infinite]"}),Ce?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-purple-400/30 border-t-purple-400"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 sm:h-5 sm:w-5 transition-transform duration-300 ${xe?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap tracking-wide",children:"製作價格樹"})]}),e.jsxs("button",{onClick:()=>kr(!tr),disabled:!ut||Sr,className:`
                      flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl transition-all duration-300
                      ${ut&&!Sr?tr?"bg-gradient-to-r from-amber-900/60 via-yellow-800/50 to-orange-900/60 border border-ffxiv-gold/60 text-ffxiv-gold":"bg-gradient-to-r from-purple-900/50 via-indigo-900/40 to-purple-900/50 border border-purple-400/40 text-purple-200 hover:text-ffxiv-gold hover:border-ffxiv-gold/50":"bg-slate-800/30 border border-slate-600/20 text-gray-600 cursor-not-allowed"}
                    `,title:Sr?"載入中...":ut?tr?"收起相關物品":"展開相關物品":"此物品未被用作材料",children:[Sr?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-purple-400/30 border-t-purple-400"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 sm:h-5 sm:w-5 transition-transform duration-300 ${tr?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap tracking-wide",children:"相關物品"})]})]})]}),rr&&u&&e.jsx("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-4 sm:p-6 mt-4",children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-ffxiv-gold"}),e.jsx("p",{className:"mt-4 text-gray-400",children:"載入取得方式..."})]}),children:e.jsx(zn,{itemId:u.id,onItemClick:He,onExpandCraftingTree:()=>{Z&&Se(a=>!a)},isCraftingTreeExpanded:xe})})}),xe&&ne&&e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-400/30 border-t-purple-400 mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"載入製作價格樹..."})]}),children:e.jsx(Yn,{tree:ne,selectedServerOption:g,selectedWorld:f,worlds:me,onItemSelect:He,excludeCrystals:Ee,onExcludeCrystalsChange:cn})}),tr&&ut&&e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-400/30 border-t-purple-400 mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"載入相關物品..."})]}),children:e.jsx(Xn,{itemId:u?.id,onItemClick:He,onCollapse:()=>kr(!1)})}),f&&g===f.section&&w&&e.jsx(An,{worldUploadTimes:w.worldUploadTimes||w.lastUploadTimes||{},worlds:me,dcWorlds:f.dcObj?.worlds||[]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold",children:"在售列表"}),(()=>{if(!(f&&g&&String(g)!==String(f.section))||!w)return null;let x=w.lastUploadTime;if(!x){const v=w.worldUploadTimes||w.lastUploadTimes||{},k=typeof g=="string"?parseInt(g):g;x=v[k]||v[String(k)]}return x?e.jsxs("span",{className:"group relative inline-flex items-center gap-1 text-xs sm:text-sm text-gray-400 font-normal cursor-pointer",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),gs(x),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-900/95 backdrop-blur-sm text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-[9999] border border-slate-600/50",children:[Xr(x),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-0",children:e.jsx("div",{className:"border-4 border-transparent border-t-slate-900/95"})})]})]}):null})()]}),e.jsx("button",{onClick:()=>Ie(a=>a+1),className:"text-xs px-2 sm:px-3 py-1 bg-purple-800/60 hover:bg-purple-700/70 rounded border border-purple-500/40 transition-colors",children:"刷新"})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:de?e.jsx("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-12 text-center flex-1 flex items-center justify-center",children:Re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-4xl mb-4",children:"⏳"}),e.jsx("p",{className:"text-sm text-yellow-400 mb-2",children:Re}),e.jsx("p",{className:"text-xs text-gray-500",children:"將在3秒後自動重試..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-6 w-6 bg-ffxiv-gold/20 rounded-full animate-pulse"})})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-400 animate-pulse",children:"正在加載市場數據..."})]})}):e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx($n,{listings:y,onRefresh:()=>Ie(a=>a+1)})})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold mb-2 sm:mb-3",children:"歷史交易"}),e.jsx("div",{className:"flex-1 flex flex-col",children:de?e.jsx("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-12 text-center flex-1 flex items-center justify-center",children:Re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-4xl mb-4",children:"⏳"}),e.jsx("p",{className:"text-sm text-yellow-400 mb-2",children:Re}),e.jsx("p",{className:"text-xs text-gray-500",children:"將在3秒後自動重試..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-6 w-6 bg-ffxiv-gold/20 rounded-full animate-pulse"})})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-400 animate-pulse",children:"正在加載歷史數據..."})]})}):e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx(_n,{history:X})})})]})]}),Fs&&e.jsx("button",{onClick:dn,className:"fixed top-[75vh] right-12 z-50 group",title:"回到頂部","aria-label":"回到頂部",children:e.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-purple-900/80 via-indigo-900/70 to-purple-900/80 backdrop-blur-md rounded-full border-2 border-ffxiv-gold/40 hover:border-ffxiv-gold/80 shadow-[0_4px_20px_rgba(0,0,0,0.3)] hover:shadow-[0_6px_30px_rgba(212,175,55,0.4)] transition-all duration-300 hover:scale-110",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-ffxiv-gold/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"relative h-5 w-5 sm:h-6 sm:w-6 text-ffxiv-gold transition-transform duration-300 group-hover:-translate-y-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})})]}),(()=>{const a=s.pathname.startsWith("/item/");return(Tt||a&&!u&&!Or&&s.pathname!=="/ultimate-price-king"&&s.pathname!=="/msq-price-checker")&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-ffxiv-gold mx-auto"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-6 w-6 bg-ffxiv-gold/20 rounded-full animate-pulse"})})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-400 animate-pulse",children:"正在載入物品..."})]})})(),(()=>{const a=s.pathname.startsWith("/item/");return!u&&h.length===0&&b.length===0&&!z&&!Or&&!Tt&&!a})()&&e.jsxs("div",{className:"space-y-4 sm:space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-8 relative z-10",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-ffxiv-gold mb-4",children:"FFXIV繁中市場小屋"}),e.jsx("div",{className:"mb-4 sm:mb-6 flex justify-center items-center",children:e.jsxs("div",{ref:T,className:"image-shatter-container relative",children:[e.jsx("img",{src:dt,alt:"Random icon",onClick:ln,draggable:!1,className:`w-16 h-16 sm:w-24 sm:h-24 object-contain cursor-pointer hover:scale-110 transition-transform duration-300 image-shatter-main ${Ot?"shattering":""}`}),l.map(a=>e.jsx("div",{className:"image-shatter-fragment",style:{"--fragment-width":`${a.width}px`,"--fragment-height":`${a.height}px`,"--image-url":`url(${dt})`,"--image-width":`${a.imgWidth}px`,"--image-height":`${a.imgHeight}px`,"--bg-x":`${a.bgX}px`,"--bg-y":`${a.bgY}px`,"--tx":`${a.tx}px`,"--ty":`${a.ty}px`,"--rot":`${a.rot}deg`,left:`${a.x}px`,top:`${a.y}px`}},a.id))]})}),e.jsx("div",{className:"max-w-md mx-auto h-10 sm:h-12 relative z-20",children:e.jsx(ps,{onSearch:vr,isLoading:z,value:d,onChange:i,disabled:!se,disabledTooltip:se?void 0:"請等待伺服器資料載入完成",selectedDcName:f?.section,onItemSelect:He})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mt-4 sm:mt-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 via-purple-900/15 to-slate-800/40 rounded-lg border border-purple-500/20 p-4 sm:p-6 card-glow hover:border-purple-400/30 transition-all duration-300 flex flex-col h-full",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"💡"}),e.jsx("span",{children:"使用提示"})]}),e.jsxs("ul",{className:"space-y-2.5 text-xs sm:text-sm text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-ffxiv-gold flex-shrink-0 mt-0.5 font-bold",children:"•"}),e.jsx("span",{children:"支持多關鍵詞搜索，用空格分隔（例如：「陳舊的 地圖」）"})]}),e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-ffxiv-gold flex-shrink-0 mt-0.5 font-bold",children:"•"}),e.jsx("span",{children:"查看物品詳情會自動保存到歷史記錄，最多保存10個物品，可在搜索欄旁的歷史記錄按鈕查看"})]}),e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-ffxiv-gold flex-shrink-0 mt-0.5 font-bold",children:"•"}),e.jsx("span",{children:"目前新版本會需要作者手動更新後端，如有功能異常請聯繫作者DC：wuperbear"})]})]}),e.jsx("div",{className:"pt-5 flex-grow",children:e.jsxs("p",{className:"text-gray-300 leading-relaxed mb-0 text-xs sm:text-sm flex items-center gap-1.5",children:["抓我玩這遊戲的人",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m0 0l-6-6m6 6l6-6"})}),e.jsx("span",{className:"text-purple-400/80",children:"沒有她就沒有這個網頁"})]})}),e.jsx("div",{className:"pt-2 mt-4 border-t border-purple-500/20",children:e.jsxs("a",{href:"https://www.twitch.tv/mehhamya",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2.5 h-[42px] bg-gradient-to-r from-purple-600/20 to-pink-600/20 hover:from-purple-600/30 hover:to-pink-600/30 rounded-lg border border-purple-500/30 hover:border-purple-400/50 transition-all duration-200 group shadow-lg hover:shadow-purple-500/20 hover:scale-105",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-400 group-hover:text-purple-300 transition-colors",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"})}),e.jsx("span",{className:"text-purple-300 group-hover:text-purple-200 font-medium",children:"Twitch"})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 via-pink-900/15 to-slate-800/40 rounded-lg border border-pink-500/20 p-4 sm:p-6 card-glow hover:border-pink-400/30 transition-all duration-300 flex flex-col h-full",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("span",{children:"作者簡介"})]}),e.jsxs("div",{className:"space-y-3 text-xs sm:text-sm text-gray-300 flex-grow",children:[e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-ffxiv-gold flex-shrink-0 mt-0.5 font-semibold",children:"遊戲ID："}),e.jsx("span",{className:"text-gray-200 font-medium",children:"貝肝煎熬（貝爾）"})]}),e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-ffxiv-gold flex-shrink-0 mt-0.5 font-semibold",children:"伺服器："}),e.jsx("span",{className:"text-gray-200",children:"巴哈姆特（轉服開啟後迦樓羅）"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-300 leading-relaxed mb-2",children:["有幫助到你的話，看到就打個招呼吧~",e.jsx("span",{className:"text-ffxiv-gold",children:"（賣我便宜點！）"})]}),e.jsxs("p",{className:"text-gray-400 text-xs sm:text-sm italic flex items-center gap-1.5 mb-0 mt-5",children:["或者...",e.jsx("span",{className:"text-amber-400/80",children:"鼓勵我"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m0 0l-6-6m6 6l6-6"})})]})]})]}),e.jsxs("div",{className:"pt-2 mt-4 border-t border-pink-500/20 flex gap-3",children:[e.jsxs("a",{href:"https://portaly.cc/beher",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2.5 h-[42px] bg-gradient-to-r from-amber-600/20 to-orange-600/20 hover:from-amber-600/30 hover:to-orange-600/30 rounded-lg border border-amber-500/30 hover:border-amber-400/50 transition-all duration-200 group shadow-lg hover:shadow-amber-500/20 hover:scale-105",children:[e.jsx("span",{className:"text-amber-400 group-hover:text-amber-300 transition-colors text-lg",children:"☕"}),e.jsx("span",{className:"text-amber-300 group-hover:text-amber-200 font-medium",children:"送我咖啡"})]}),e.jsxs("a",{href:"https://forum.gamer.com.tw/C.php?bsn=17608&snA=28740",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2.5 h-[42px] bg-gradient-to-r from-[#11AAC1]/20 to-[#11AAC1]/30 hover:from-[#11AAC1]/30 hover:to-[#11AAC1]/40 rounded-lg border border-[#11AAC1]/30 hover:border-[#11AAC1]/50 transition-all duration-200 group shadow-lg hover:shadow-[#11AAC1]/20 hover:scale-105 text-[#11AAC1]",children:[e.jsx("img",{src:Fe("baha_icon.png"),alt:"巴哈姆特",className:"h-5 w-5 transition-colors"}),e.jsx("span",{className:"font-medium",children:"與巴友分享"})]})]})]})]})]}),e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-400/30 border-t-purple-400 mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"載入歷史記錄..."})]}),children:e.jsx(Jn,{onItemSelect:He})}),e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 rounded-lg border border-purple-500/20 p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-400/30 border-t-purple-400 mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"載入最近更新..."})]}),children:e.jsx(Gn,{onItemSelect:He,selectedDcName:f?.section})}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-slate-900/40 to-slate-800/60 backdrop-blur-sm rounded-lg border border-slate-600/30 p-4 sm:p-6 mt-4 sm:mt-6",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-slate-300 mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-ffxiv-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),"致謝"]}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 mb-3 sm:mb-4",children:"本專案得以實現，感謝以下優秀的服務與資料來源："}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("a",{href:"https://universalis.app/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-slate-700/30 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-all duration-200 group",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-blue-600/20 to-blue-800/20 rounded-lg flex items-center justify-center border border-blue-500/30 group-hover:border-blue-400/50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-slate-200 group-hover:text-white transition-colors",children:"Universalis API"}),e.jsx("div",{className:"text-xs text-slate-400 mt-0.5",children:"提供完整的市場看板數據"})]})]}),e.jsxs("a",{href:"https://xivapi.com/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-slate-700/30 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-all duration-200 group",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-purple-600/20 to-purple-800/20 rounded-lg flex items-center justify-center border border-purple-500/30 group-hover:border-purple-400/50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-slate-200 group-hover:text-white transition-colors",children:"XIVAPI"}),e.jsx("div",{className:"text-xs text-slate-400 mt-0.5",children:"提供物品圖片與遊戲數據"})]})]}),e.jsxs("a",{href:"https://github.com/ffxiv-teamcraft/ffxiv-teamcraft",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-slate-700/30 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-all duration-200 group",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-indigo-600/20 to-indigo-800/20 rounded-lg flex items-center justify-center border border-indigo-500/30 group-hover:border-indigo-400/50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5 text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-slate-200 group-hover:text-white transition-colors",children:"FFXIV Teamcraft"}),e.jsx("div",{className:"text-xs text-slate-400 mt-0.5",children:"提供製作配方數據"})]})]}),e.jsxs("a",{href:"https://www.garlandtools.org/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-slate-700/30 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 transition-all duration-200 group",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-green-600/20 to-green-800/20 rounded-lg flex items-center justify-center border border-green-500/30 group-hover:border-green-400/50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 sm:h-5 sm:w-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs sm:text-sm font-semibold text-slate-200 group-hover:text-white transition-colors",children:"Garland Tools"}),e.jsx("div",{className:"text-xs text-slate-400 mt-0.5",children:"提供物品資訊與圖標"})]})]})]})]})]})]})}),e.jsx(In,{isOpen:Vt,onClose:()=>St(!1),taxRates:Lr,worlds:me,isLoading:Ir,selectedWorld:f,selectedServerOption:g,onServerOptionChange:Dt})]}):e.jsx(Vn,{})}"scrollRestoration"in history&&(history.scrollRestoration="manual");window.scrollTo(0,0);document.documentElement.scrollTop=0;document.body.scrollTop=0;const ea=document.location.pathname.includes("/FFXIV_Market")?"/FFXIV_Market/":"/";fn.createRoot(document.getElementById("root")).render(e.jsx(xn,{basename:ea,children:e.jsx(Zn,{})}));export{ts as I,fs as S,Hn as T,Dn as a,qs as b,In as c,da as d,ca as e,Jr as g,ws as u};
