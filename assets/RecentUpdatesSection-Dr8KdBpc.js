import{r as o,j as t}from"./react-vendor-DmEpS5Kz.js";import{I as y,e as R}from"./index-CDnSI-_z.js";import{g as k}from"./services-data-DOFC0cEd.js";import"./vendor-dPMYpV4t.js";import"./axios-B9ygI19o.js";import"./opencc-C1Qz6KEM.js";import"./data-tw-items-4ChDDRSh.js";import"./data-tw-descriptions-CJIEoqIq.js";function W({onItemSelect:c,selectedDcName:i}){const[d,u]=o.useState([]),[a,m]=o.useState(!1),[g,b]=o.useState(0),s=o.useRef(null),n=o.useRef(!1),p=3e3,f=async()=>{if(!(!i||a)){s.current&&s.current.abort(),s.current=new AbortController,m(!0);try{const e=await R(i,10,{signal:s.current.signal});if(!e||e.length===0){u([]),m(!1);return}const j=(await Promise.all(e.map(async r=>{try{const h=await k(r.itemID);return{...r,name:h?.name||`物品 #${r.itemID}`,itemDetails:h}}catch{return{...r,name:`物品 #${r.itemID}`,itemDetails:null}}}))).filter(r=>r.itemDetails),x=new Set,I=j.filter(r=>x.has(r.itemID)?!1:(x.add(r.itemID),!0));u(I)}catch(e){e.name!=="AbortError"&&console.error("Failed to fetch recent items:",e)}finally{m(!1)}}};o.useEffect(()=>(i&&f(),()=>{s.current&&s.current.abort()}),[i]);const v=()=>{const e=Date.now(),l=e-g;n.current||l<p||(n.current=!0,b(e),f(),setTimeout(()=>{n.current=!1},p))},w=e=>{c&&e.itemDetails&&c(e.itemDetails)};return i?t.jsxs("div",{className:"mb-6 bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h3",{className:"text-lg sm:text-xl font-semibold text-ffxiv-gold flex items-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 sm:h-6 sm:w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"最近更新的物品"]}),t.jsxs("button",{onClick:v,disabled:n.current||a,className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium rounded-md border transition-all duration-200 flex items-center gap-1.5 ${n.current||a?"bg-slate-700/60 text-gray-500 border-slate-600/40 cursor-not-allowed":"bg-purple-800/60 hover:bg-purple-700/70 text-gray-200 hover:text-white border-purple-500/40 hover:border-purple-400/60"}`,title:n.current?"請稍候再試":"刷新",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3.5 w-3.5 sm:h-4 sm:w-4 ${a?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),t.jsx("span",{children:"刷新"})]})]}),a?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-ffxiv-gold"}),t.jsx("span",{className:"ml-3 text-sm text-gray-400",children:"載入中..."})]}):d.length===0?t.jsx("div",{className:"py-8 text-center text-sm text-gray-400",children:"暫無數據"}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:d.map((e,l)=>t.jsx("button",{onClick:()=>w(e),className:"bg-gradient-to-br from-purple-900/30 via-pink-900/20 to-indigo-900/30 rounded-lg p-3 sm:p-4 border border-purple-500/30 hover:border-ffxiv-gold/50 transition-all hover:scale-105 group",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(y,{itemId:e.itemID,alt:e.name,className:"w-12 h-12 sm:w-16 sm:h-16 object-contain rounded border border-purple-500/30 bg-slate-900/50 group-hover:border-ffxiv-gold/50 transition-colors"}),t.jsx("p",{className:"text-xs sm:text-sm text-white font-medium text-center line-clamp-2 group-hover:text-ffxiv-gold transition-colors",title:e.name,children:e.name})]})},`${e.itemID}-${l}`))})]}):null}export{W as default};
