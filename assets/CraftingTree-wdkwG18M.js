import{r as u,j as e}from"./react-vendor-DmEpS5Kz.js";import{d as ae,I as ie}from"./index-CDnSI-_z.js";import{g as se,d as oe}from"./services-data-DOFC0cEd.js";import{g as te}from"./internalUrl-BGvhBhUH.js";import"./vendor-dPMYpV4t.js";import"./axios-B9ygI19o.js";import"./opencc-C1Qz6KEM.js";import"./data-tw-items-4ChDDRSh.js";import"./data-tw-descriptions-CJIEoqIq.js";function f(s){return s==null?"0":Math.round(s).toLocaleString()}function ce({text:s,onCopy:t}){const[n,l]=u.useState(!1),x=async i=>{i.stopPropagation();try{await navigator.clipboard.writeText(s),l(!0),t&&t(),setTimeout(()=>l(!1),1500)}catch(o){console.error("Failed to copy:",o)}};return e.jsx("button",{onClick:x,className:`
        p-0.5 rounded transition-all duration-200 flex-shrink-0
        ${n?"text-green-400":"text-gray-500 hover:text-ffxiv-gold hover:bg-purple-800/40"}
      `,title:n?"已複製":"複製名稱",children:n?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})}function E({isOpen:s,onClose:t,breakdown:n,itemNames:l,itemPrices:x,parentPrice:i,childrenTotalPrice:o,yields:c,isRoot:h=!1,amount:m=1,parentUnitPrice:p=null}){if(!s)return null;const b=p!==null?p:i!==null&&m>1?i/m:i,C=d=>{d.target===d.currentTarget&&t()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:C,children:e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-purple-500/50 shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-purple-500/30",children:[e.jsx("h3",{className:"text-lg font-semibold text-ffxiv-gold",children:"計算公式詳情"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[n&&n.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"材料成本明細："}),e.jsx("div",{className:"space-y-2",children:n.map((d,g)=>{const v=l[d.itemId]||`物品 ${d.itemId}`;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-700/50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-gray-300",children:v}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.amount," 個 × ",f(d.unitCost)," = ",f(d.totalCost),d.method==="craft"&&" (製作)"]})]}),e.jsx("div",{className:"text-sm font-semibold text-green-400",children:f(d.totalCost)})]},g)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"材料總成本："}),e.jsx("span",{className:"text-base font-bold text-green-400",children:f(n.reduce((d,g)=>d+g.totalCost,0))})]}),c&&c>1&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-500/20",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm text-gray-400",children:["製作產出數量：",e.jsx("span",{className:"text-blue-300 font-semibold",children:c})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"單個成本 = 總成本 ÷ 產出數量："}),e.jsxs("span",{className:"text-base font-bold text-blue-400",children:[f(n.reduce((d,g)=>d+g.totalCost,0))," ÷ ",c," ≈ ",f(n.reduce((d,g)=>d+g.totalCost,0)/c)]})]})]})]})]}):o!==null&&typeof o=="number"?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"材料成本："}),e.jsxs("div",{className:"p-2 bg-slate-700/50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"材料總成本："}),e.jsx("span",{className:"text-base font-bold text-green-400",children:c&&c>1?`${f(o*c)} ÷ ${c} ≈ ${f(o)}`:f(o)})]}),c&&c>1&&e.jsx("div",{className:"mt-2 pt-2 border-t border-purple-500/20",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["製作產出數量：",e.jsx("span",{className:"text-blue-300 font-semibold",children:c}),"，已納入成本考量"]})})]})]}):null,i!==null&&o!==null&&typeof o=="number"&&e.jsxs("div",{className:"pt-4 border-t border-purple-500/30",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"價格比較："}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-700/50 rounded",children:[e.jsxs("span",{className:"text-sm text-gray-300",children:["製作成本",h&&c&&c>1?` (已考慮產出數量=${c})`:"","："]}),e.jsx("span",{className:"text-sm font-semibold text-green-400",children:c&&c>1?`${f(o*c)} ÷ ${c} ≈ ${f(o)}`:f(o)})]}),e.jsxs("div",{className:"p-2 bg-slate-700/50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"購買成本："}),e.jsx("span",{className:"text-sm font-semibold text-yellow-400",children:f(i)})]}),m>1&&b!==null&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["單價：",f(b)," × ",m," 個 = ",f(i)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-700/50 rounded mt-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"差額："}),e.jsxs("span",{className:`text-sm font-bold ${i-o>0?"text-green-400":"text-red-400"}`,children:[i>o?"+":"",f(i-o)]})]})]})]})]})]})})}function de({node:s,itemName:t,priceInfo:n,onItemClick:l,isRoot:x=!1,isLoading:i=!1,isPriceQueried:o=!1,nodeRef:c,isHighlighted:h=!1,highlightMethod:m=null,isDcQuery:p=!1}){return e.jsxs("div",{ref:c,className:`
        flex flex-col items-center p-2 rounded-lg cursor-pointer transition-all duration-200
        ${x?"bg-gradient-to-br from-ffxiv-gold/20 to-yellow-500/10 border-2 border-ffxiv-gold/50 hover:border-ffxiv-gold min-w-[120px]":h?m==="craft"?"bg-gradient-to-br from-green-900/40 to-emerald-900/30 border-2 border-green-500/60 hover:border-green-400 min-w-[100px] shadow-[0_0_10px_rgba(34,197,94,0.2)]":"bg-gradient-to-br from-blue-900/40 to-cyan-900/30 border-2 border-blue-500/60 hover:border-blue-400 min-w-[100px] shadow-[0_0_10px_rgba(59,130,246,0.2)]":"bg-slate-800/60 border border-purple-500/30 hover:border-purple-400/60 hover:bg-slate-700/60 min-w-[100px]"}
      `,onClick:()=>l(s.itemId),title:`查看 ${t}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{itemId:s.itemId,alt:t,className:`${x?"w-12 h-12":"w-9 h-9"} object-contain rounded border border-purple-500/30`,priority:x}),!x&&s.amount>1&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-purple-900/90 text-ffxiv-gold text-xs font-bold px-1 py-0.5 rounded-full border border-purple-500/50 min-w-[18px] text-center leading-none",children:s.amount})]}),e.jsxs("div",{className:`mt-1.5 flex items-center gap-0.5 max-w-[100px] ${x?"max-w-[120px]":""}`,children:[e.jsx("p",{className:`${x?"text-xs font-semibold text-ffxiv-gold":"text-xs text-gray-300"} truncate flex-1`,title:t,children:t}),e.jsx(ce,{text:t})]}),e.jsx("div",{className:`mt-1 text-center ${n?.worldName?"h-[32px]":"h-[20px]"} flex flex-col justify-center`,children:i?e.jsx("div",{className:"text-xs text-gray-500 animate-pulse",children:"載入中..."}):n&&n.price!==null&&n.price!==void 0&&n.price>0?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[n.isHQ&&e.jsx("span",{className:"px-1 py-0.5 text-[10px] font-bold text-ffxiv-gold border border-ffxiv-gold/50 rounded bg-ffxiv-gold/10 cursor-default",children:"HQ"}),e.jsx("span",{className:`text-xs font-semibold ${n.isHQ?"text-yellow-400":"text-green-400"}`,children:f(n.price)}),!p&&n.priceType==="minListing"&&e.jsx("span",{className:"text-[8px] text-blue-400 cursor-help",title:"最近四天無銷售發生，改為用最低價格",children:"⚠"})]}),n.worldName&&e.jsx("span",{className:"text-[10px] text-gray-500 truncate max-w-[80px]",title:n.worldName,children:n.worldName})]}):o?e.jsx("span",{className:"text-xs text-gray-500",children:"無販售"}):e.jsx("div",{className:"text-xs text-gray-500 animate-pulse",children:"查詢中..."})})]})}function G(s,t,n){const x=t[s.itemId]?.price??null,i=s.children&&s.children.length>0,o=n.has(s.itemId);if(!i)return o&&x===null?{cost:"N/A",method:"buy",breakdown:null}:{cost:x,method:"buy",breakdown:null};let c=!0;for(const d of s.children)if(!n.has(d.itemId)){c=!1;break}if(!c)return o&&x===null?{cost:"N/A",method:"buy",breakdown:null}:{cost:x,method:"buy",breakdown:null};let h=0,m=!1;const p=[];for(const d of s.children){const g=G(d,t,n);if(g.cost==="N/A"){m=!0;break}else if(g.cost!==null&&typeof g.cost=="number"){const v=g.cost*d.amount;h+=v,p.push({itemId:d.itemId,amount:d.amount,unitCost:g.cost,totalCost:v,method:g.method})}else{m=!0;break}}if(m)return x!==null?{cost:x,method:"buy",breakdown:null}:o?{cost:"N/A",method:"buy",breakdown:null}:{cost:null,method:"buy",breakdown:null};const b=s.yields||1,C=b>1?h/b:h;return x===null?o?{cost:C,method:"craft",breakdown:p,yields:b}:{cost:null,method:"buy",breakdown:null}:C<x?{cost:C,method:"craft",breakdown:p,yields:b}:{cost:x,method:"buy",breakdown:null}}function q(s,t,n){if(!s.children||s.children.length===0)return null;let l=!0;for(const o of s.children)if(!n.has(o.itemId)){l=!1;break}if(!l)return null;let x=0;for(const o of s.children){const c=G(o,t,n);if(c.cost==="N/A")return"N/A";if(c.cost!==null&&typeof c.cost=="number"){const h=c.cost*o.amount;x+=h}else return null}const i=s.yields||1;return i>1?x/i:x}function Z(s,t,n,l=new Map){if(!(s.children&&s.children.length>0))return l.set(s.itemId,"buy"),l;let i=!0;for(const h of s.children)if(!n.has(h.itemId)){i=!1;break}if(!i)return l;const o=q(s,t,n);if(o===null||o==="N/A")return l.set(s.itemId,"buy"),l;const c=t[s.itemId]?.price??null;if(typeof o=="number"&&(c===null||o<c)){l.set(s.itemId,"craft");for(const h of s.children)Z(h,t,n,l)}else l.set(s.itemId,"buy");return l}function xe({tree:s,itemPrices:t,queriedItemIds:n,itemNames:l}){const[x,i]=u.useState(!1),o=t[s.itemId]?.price??null,c=s.amount||1,h=u.useMemo(()=>{if(!s||!s.children||s.children.length===0)return null;let g=!0;for(const _ of s.children)if(!n.has(_.itemId)){g=!1;break}if(!g||!n.has(s.itemId))return null;const F=G(s,t,n),$=q(s,t,n);if($===null)return null;const L=t[s.itemId]?.price??null,j=$,W=L===null,J=j==="N/A",A=typeof j=="number",z=F?.breakdown||null,S=s.yields||1;if(J&&W)return{canCraft:!1,isInsufficientInfo:!0};if(J&&L!==null)return{rootPrice:L,cheapestRouteCost:"N/A",canCraft:!0,isMaterialsNA:!0,isCraftOnly:!1,breakdown:z,yields:S};if(A&&W)return{rootPrice:null,cheapestRouteCost:j,canCraft:!0,isCraftOnly:!0,breakdown:z,yields:S};if(A&&L!==null){const _=L-j;return{rootPrice:L,cheapestRouteCost:j,savings:_,canCraft:!0,isCraftOnly:!1,breakdown:z,yields:S}}return{canCraft:!1}},[s,t,n]);if(!h)return null;if(h.isInsufficientInfo)return e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-orange-900/50 border border-orange-500/40 text-orange-300 w-max min-w-max",children:e.jsx("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"該服缺乏關鍵素材且無成品購買"})]})})});if(!h.canCraft)return null;if(h.isMaterialsNA)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-blue-900/50 border border-blue-500/40 text-blue-300 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>i(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsx("span",{className:"flex-shrink-0",children:"最優製作: N/A"}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:["直購成品: ",f(h.rootPrice)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議直購"})]})]})}),e.jsx(E,{isOpen:x,onClose:()=>i(!1),breakdown:h.breakdown,itemNames:l,itemPrices:t,parentPrice:h.rootPrice,childrenTotalPrice:null,yields:h.yields,isRoot:!0,amount:c,parentUnitPrice:o})]});if(h.isCraftOnly)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 py-2.5 rounded-lg text-sm font-medium bg-green-900/50 border border-green-500/40 text-green-300 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>i(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["自製最佳: ",f(h.cheapestRouteCost)]})]})]})}),e.jsx(E,{isOpen:x,onClose:()=>i(!1),breakdown:h.breakdown,itemNames:l,itemPrices:t,parentPrice:null,childrenTotalPrice:h.cheapestRouteCost,yields:h.yields,isRoot:!0,amount:c,parentUnitPrice:o})]});const{rootPrice:m,cheapestRouteCost:p,savings:b}=h,C=b>0,d=Math.abs(b);return d<1?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 py-2.5 rounded-lg bg-gray-700/50 border border-gray-500/30 text-sm text-gray-400 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>i(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["最優製作: ",f(p)]}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:["直購成品: ",f(m)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"價格相同"})]})]})}),e.jsx(E,{isOpen:x,onClose:()=>i(!1),breakdown:h.breakdown,itemNames:l,itemPrices:t,parentPrice:m,childrenTotalPrice:p,yields:h.yields,isRoot:!0,amount:c,parentUnitPrice:o})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`
          px-4 py-2.5 rounded-lg text-sm font-medium w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity
          ${C?"bg-green-900/50 border border-green-500/40 text-green-300":"bg-red-900/50 border border-red-500/40 text-red-300"}
        `,onClick:()=>i(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:"text-xs opacity-70 text-center whitespace-nowrap",children:"以最優路線計算（每項材料取買/製的較低價）"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["最優製作: ",f(p)]}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:["直購成品: ",f(m)]})]}),e.jsx("div",{className:"flex items-center gap-1.5 mt-0.5 whitespace-nowrap",children:C?e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["建議自製，省 ",f(d)]})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["建議直購，省 ",f(d)]})]})})]})}),e.jsx(E,{isOpen:x,onClose:()=>i(!1),breakdown:h.breakdown,itemNames:l,itemPrices:t,parentPrice:m,childrenTotalPrice:p,yields:h.yields,isRoot:!0})]})}function he({parentPrice:s,childrenTotalPrice:t,isReady:n,amount:l=1,breakdown:x=null,itemNames:i={},itemPrices:o={},yields:c=1,parentUnitPrice:h=null}){const[m,p]=u.useState(!1);if(!n)return null;const b=s!=null,C=t!==null&&t!=="N/A"&&typeof t=="number",d=t==="N/A",g=s==null,v=h!==null?h:s!==null&&l>1?s/l:s;if(d&&g)return e.jsx("div",{className:"px-2 py-1 rounded-lg bg-gray-700/50 border border-gray-500/30 text-xs text-gray-400",children:"資訊不足"});if(d&&b)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-blue-900/50 border border-blue-500/40 text-blue-300 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>p(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsx("span",{className:"flex-shrink-0",children:"材料: N/A"}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[l>1?`${l}個`:"","成品: ",f(s)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議直購"})]})]})}),e.jsx(E,{isOpen:m,onClose:()=>p(!1),breakdown:x,itemNames:i,itemPrices:o,parentPrice:s,childrenTotalPrice:null,yields:c,isRoot:!1,amount:l,parentUnitPrice:v})]});if(C&&g)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-green-900/50 border border-green-500/40 text-green-300 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>p(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["材料: ",f(t)]}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[l>1?`${l}個`:"","成品: N/A"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"建議自製"})]})]})}),e.jsx(E,{isOpen:m,onClose:()=>p(!1),breakdown:x,itemNames:i,itemPrices:o,parentPrice:null,childrenTotalPrice:t,yields:c,isRoot:!1,amount:l,parentUnitPrice:v})]});if(!C||!b)return null;const F=s-t,$=F>0,L=Math.abs(F);return L<1?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-gray-700/50 border border-gray-500/30 text-xs text-gray-400 w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>p(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["材料: ",f(t)]}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[l>1?`${l}個`:"","成品: ",f(s)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-bold flex-shrink-0",children:"價格相同"})]})]})}),e.jsx(E,{isOpen:m,onClose:()=>p(!1),breakdown:x,itemNames:i,itemPrices:o,parentPrice:s,childrenTotalPrice:t,yields:c,isRoot:!1})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`
          px-3 py-1.5 rounded-lg text-xs font-medium w-max min-w-max cursor-pointer hover:opacity-80 transition-opacity
          ${$?"bg-green-900/50 border border-green-500/40 text-green-300":"bg-red-900/50 border border-red-500/40 text-red-300"}
        `,onClick:()=>p(!0),title:"點擊查看計算公式",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-80 whitespace-nowrap",children:[e.jsxs("span",{className:"flex-shrink-0",children:["材料: ",f(t)]}),e.jsx("span",{className:"flex-shrink-0",children:"vs"}),e.jsxs("span",{className:"flex-shrink-0",children:[l>1?`${l}個`:"","成品: ",f(s)]})]}),e.jsx("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:$?e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["自製省 ",f(L)]})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("span",{className:"font-bold flex-shrink-0",children:["直購省 ",f(L)]})]})})]})}),e.jsx(E,{isOpen:m,onClose:()=>p(!1),breakdown:x,itemNames:i,itemPrices:o,parentPrice:s,childrenTotalPrice:t,yields:c,isRoot:!1,amount:l,parentUnitPrice:v})]})}function re({node:s,itemNames:t,itemPrices:n,queriedItemIds:l,onItemClick:x,isRoot:i=!1,isLoading:o=!1,optimalPathMap:c=null,isCraftingCheaper:h=!1,isDcQuery:m=!1}){const p=u.useRef(null),[b,C]=u.useState({left:0,width:0}),d=s.children&&s.children.length>0,g=t[s.itemId]||`物品 ${s.itemId}`,v=n[s.itemId],F=l.has(s.itemId),$=c?.get(s.itemId),L=h&&$!==void 0,j=L&&$==="craft",{childrenTotalPrice:W,breakdown:J}=u.useMemo(()=>{if(!d)return{childrenTotalPrice:null,breakdown:null};let M=!0;for(const k of s.children)if(!l.has(k.itemId)){M=!1;break}if(!M)return{childrenTotalPrice:null,breakdown:null};const w=G(s,n,l);if(w.cost==="N/A")return{childrenTotalPrice:"N/A",breakdown:w.breakdown};if(w.cost===null)return{childrenTotalPrice:null,breakdown:null};if(typeof w.cost=="number"){let k=w.breakdown;if(!k){k=[];for(const N of s.children){const B=n[N.itemId];if(B&&B.price!==void 0){const I=B.price*N.amount;k.push({itemId:N.itemId,amount:N.amount,unitCost:B.price,totalCost:I,method:"buy"})}}}if(w.method==="craft"&&w.breakdown)return{childrenTotalPrice:w.cost,breakdown:k};{let N=0;for(const H of s.children){const P=n[H.itemId];if(P&&P.price!==void 0)N+=P.price*H.amount;else return{childrenTotalPrice:"N/A",breakdown:k.length>0?k:null}}const B=s.yields||1;return{childrenTotalPrice:B>1?N/B:N,breakdown:k.length>0?k:null}}}return{childrenTotalPrice:null,breakdown:null}},[d,s,n,l]),A=u.useMemo(()=>{if(!d)return!1;let M=!0;for(const k of s.children)if(!l.has(k.itemId)){M=!1;break}return!M||W===null?!1:l.has(s.itemId)},[d,s.children,v,W,l]),z=u.useCallback(()=>{if(d&&s.children.length>1&&p.current){const M=p.current,w=M.children;if(w.length>=2){const k=w[0],N=w[w.length-1],B=M.getBoundingClientRect(),I=k.getBoundingClientRect(),H=N.getBoundingClientRect(),P=I.left+I.width/2-B.left,O=H.left+H.width/2-B.left;O-P>0&&C({left:P,width:O-P})}}},[d,s.children?.length]);u.useEffect(()=>{const M=setTimeout(z,50);let w;return p.current&&typeof ResizeObserver<"u"&&(w=new ResizeObserver(()=>{z()}),w.observe(p.current)),()=>{clearTimeout(M),w&&w.disconnect()}},[z,t,n]);const S=j?"bg-green-400":"bg-purple-500/50",_=j?"w-0.5":"w-px",V=j?"shadow-[0_0_6px_rgba(74,222,128,0.6)]":"";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(de,{node:s,itemName:g,priceInfo:v,onItemClick:x,isRoot:i,isLoading:o,isPriceQueried:F,isHighlighted:L&&!i,highlightMethod:$,isDcQuery:m}),d&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`${_} ${s.yields&&s.yields>1?"h-2":"h-4"} ${S} ${V}`}),s.yields&&s.yields>1&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"px-2 py-0.5 rounded-md bg-yellow-900/40 border border-yellow-600/50 text-[10px] text-yellow-300 whitespace-nowrap",children:["單次製作產出 ",s.yields," 個"]}),e.jsx("div",{className:`${_} h-2 ${S} ${V}`})]}),i?e.jsx(xe,{tree:s,itemPrices:n,queriedItemIds:l,itemNames:t}):e.jsx(he,{parentPrice:v?.price?v.price*s.amount:null,childrenTotalPrice:W,isReady:A,amount:s.amount,breakdown:J,itemNames:t,itemPrices:n,yields:s.yields||1,parentUnitPrice:v?.price||null}),e.jsx("div",{className:`${_} h-4 ${S} ${V}`}),e.jsxs("div",{className:"relative",children:[s.children.length>1&&b.width>0&&e.jsx("div",{className:`absolute top-0 ${j?"h-0.5":"h-px"} ${S} ${V}`,style:{left:`${b.left}px`,width:`${b.width}px`}}),e.jsx("div",{ref:p,className:"flex gap-3 items-start",children:s.children.map((M,w)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`${j?"w-0.5 bg-green-400 shadow-[0_0_6px_rgba(74,222,128,0.6)]":"w-px bg-purple-500/50"} h-4`}),e.jsx(re,{node:M,itemNames:t,itemPrices:n,queriedItemIds:l,onItemClick:x,isLoading:o,optimalPathMap:c,isCraftingCheaper:h&&j,isDcQuery:m})]},`${M.itemId}-${w}`))})]})]})]})}function Ne({tree:s,selectedServerOption:t,selectedWorld:n,worlds:l={},onItemSelect:x,excludeCrystals:i=!0,onExcludeCrystalsChange:o}){const[c,h]=u.useState({}),[m,p]=u.useState({}),[b,C]=u.useState(new Set),[d,g]=u.useState(!0),[v,F]=u.useState(!0),[$,L]=u.useState(null),j=u.useRef(null),[W,J]=u.useState(!1),[A,z]=u.useState(!1),[S,_]=u.useState(0),[V,M]=u.useState(0),[w,k]=u.useState([]),N=u.useMemo(()=>{if(!t)return!1;const r=n?.section;return t===r},[t,n]),B=u.useMemo(()=>{if(!t)return null;const r=n?.section;if(t===r)return`${r}（全服搜尋）`;if(typeof t=="number"||!isNaN(Number(t))){const a=typeof t=="number"?t:Number(t);return l[a]||`伺服器 ${t}`}else return t},[t,n,l]),I=u.useCallback((r,a=new Set)=>(r&&(a.add(r.itemId),r.children&&r.children.forEach(y=>I(y,a))),a),[]),H=u.useCallback(r=>({8:"CRP",9:"BSM",10:"ARM",11:"GSM",12:"LTW",13:"WVR",14:"ALC",15:"CUL"})[r],[]),P=u.useCallback(r=>{const a=H(r);return a?`https://garlandtools.org/files/icons/job/${a}.png`:null},[H]);u.useEffect(()=>{if(!s||!s.itemId){k([]);return}(async()=>{try{const a=await oe(s.itemId),y=[...new Set(a.map(R=>R.job).filter(Boolean))];k(y)}catch(a){console.error("Failed to load crafting jobs:",a),k([])}})()},[s]),u.useEffect(()=>{if(!s)return;const r=Array.from(I(s));g(!0),Promise.all(r.map(async a=>{const y=await se(a);return{id:a,name:y?.name||`物品 ${a}`}})).then(a=>{const y={};a.forEach(({id:R,name:U})=>{y[R]=U}),h(y),g(!1)}).catch(a=>{console.error("Failed to load item names:",a),L("載入物品名稱失敗"),g(!1)})},[s,I]),u.useEffect(()=>{const r=l&&Object.keys(l).length>0;if(!s||!t||!r)return;const a=I(s),y=Array.from(a),R=[...new Set(y)];F(!0),C(new Set),p({}),L(null),(async()=>{try{const Q=[];for(let D=0;D<R.length;D+=100)Q.push(R.slice(D,D+100));for(const D of Q){const X=await ae(t,D,l);p(T=>({...T,...X})),C(T=>new Set([...T,...D])),Q.length>1&&await new Promise(T=>setTimeout(T,100))}}catch(Q){console.error("Failed to fetch prices:",Q),C(new Set(R))}F(!1)})()},[s,t,l,I]);const O=u.useCallback(r=>{if(x)se(r).then(a=>{if(a)x(a);else{const y=`${window.location.origin}${te(`/item/${r}`)}`;window.open(y,"_blank","noopener,noreferrer")}});else{const a=`${window.location.origin}${te(`/item/${r}`)}`;window.open(a,"_blank","noopener,noreferrer")}},[x]);u.useEffect(()=>{const r=()=>{if(j.current){const y=j.current,R=y.scrollWidth>y.clientWidth;J(R)}};r();const a=new ResizeObserver(r);return j.current&&a.observe(j.current),()=>{a.disconnect()}},[s,c,m]);const ne=u.useCallback(r=>{if(!j.current||!W)return;const a=r.target;a.closest("button, a, [data-item-id], img, svg, path")||a.tagName==="BUTTON"||a.tagName==="A"||a.tagName==="IMG"||a.tagName==="SVG"||a.tagName==="PATH"||a.closest(".cursor-pointer")||(z(!0),_(r.clientX),M(j.current.scrollLeft),r.preventDefault(),r.stopPropagation())},[W]),K=u.useCallback(r=>{if(!A||!j.current)return;const a=r.clientX-S;j.current.scrollLeft=V-a,r.preventDefault(),r.stopPropagation()},[A,S,V]),Y=u.useCallback(()=>{z(!1)},[]);u.useEffect(()=>{if(A)return document.addEventListener("mousemove",K),document.addEventListener("mouseup",Y),document.body.style.cursor="grabbing",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",Y),document.body.style.cursor="",document.body.style.userSelect=""}},[A,K,Y]);const{optimalPathMap:le,isCraftingCheaper:ee}=u.useMemo(()=>{if(!s||v||Object.keys(m).length===0)return{optimalPathMap:null,isCraftingCheaper:!1};if(!s.children||s.children.length===0)return{optimalPathMap:null,isCraftingCheaper:!1};for(const U of s.children)if(!b.has(U.itemId))return{optimalPathMap:null,isCraftingCheaper:!1};const r=q(s,m,b);if(r===null)return{optimalPathMap:null,isCraftingCheaper:!1};if(r==="N/A")return{optimalPathMap:null,isCraftingCheaper:!1};const a=m[s.itemId]?.price??null;return a===null?typeof r=="number"?{optimalPathMap:Z(s,m,b),isCraftingCheaper:!0}:{optimalPathMap:null,isCraftingCheaper:!1}:typeof r!="number"?{optimalPathMap:null,isCraftingCheaper:!1}:r<a?{optimalPathMap:Z(s,m,b),isCraftingCheaper:!0}:{optimalPathMap:null,isCraftingCheaper:!1}},[s,m,b,v]);return s?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/60 via-purple-900/20 to-slate-800/60 backdrop-blur-sm rounded-lg border border-purple-500/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[w.length>0&&e.jsx("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-slate-800/60 border border-slate-600/40",children:w.map(r=>{const a=P(r);return a?e.jsx("img",{src:a,alt:H(r)||`Job ${r}`,className:"w-5 h-5 object-contain",title:H(r)||`Job ${r}`},r):null}).filter(Boolean)}),e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-ffxiv-gold flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"製作價格樹"]}),t&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-purple-900/40 border border-purple-500/30 text-xs",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),e.jsx("span",{className:"text-purple-300",children:B})]}),o&&e.jsxs("div",{className:"relative flex items-center gap-2 px-2 py-1 rounded-md bg-slate-800/60 border border-slate-600/40 text-xs group overflow-hidden ",onClick:r=>r.stopPropagation(),style:i?{}:{boxShadow:"0 0 8px rgba(147, 51, 234, 0.3)",animation:"crystalShimmer 3s ease-in-out infinite"},children:[!i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-purple-400/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-in-out pointer-events-none"}),e.jsx("span",{className:"text-gray-400 cursor-help relative z-10",children:"顯示水晶"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),o(!i)},className:`
                  relative inline-flex h-5 w-9 items-center rounded-full transition-all duration-200 ease-in-out z-10
                  ${i?"bg-purple-600/50":"bg-ffxiv-gold/70 shadow-[0_0_6px_rgba(212,175,55,0.4)]"}
                  focus:outline-none focus:ring-2 focus:ring-ffxiv-gold focus:ring-offset-2 focus:ring-offset-slate-800
                `,role:"switch","aria-checked":!i,"aria-label":i?"顯示水晶物品":"隱藏水晶物品",children:e.jsx("span",{className:`
                    inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out
                    ${i?"translate-x-1":"translate-x-5"}
                    ${i?"":"shadow-[0_0_4px_rgba(255,255,255,0.5)]"}
                  `})}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-900/95 text-white text-xs rounded shadow-lg border border-purple-500/50 whitespace-nowrap opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-200 z-[9999]",children:["提供給大量製作的匠人更精確定位價格",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-purple-500/50"})]})]}),e.jsx("style",{children:`
            @keyframes crystalShimmer {
              0%, 100% {
                box-shadow: 0 0 8px rgba(147, 51, 234, 0.3);
              }
              50% {
                box-shadow: 0 0 12px rgba(147, 51, 234, 0.5), 0 0 20px rgba(147, 51, 234, 0.2);
              }
            }
          `})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!v&&s&&m[s.itemId]&&(()=>{const r=m[s.itemId],a=r?.priceType||(N?"minListing":"average"),y=!N&&a==="minListing",R=r.price!==null&&r.price!==void 0,U=r.velocityWorld!==void 0,Q=r.velocityDc!==void 0,D=r.velocityWorld??0,X=r.velocityDc??0,T=!N&&!R;return e.jsxs("div",{className:"flex flex-col gap-1",children:[N?e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md bg-blue-900/30 border border-blue-500/20 text-xs text-blue-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-blue-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"whitespace-nowrap",children:"價格為全服最低在售價格"})]}):T?e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md bg-red-900/50 border border-red-500/40 text-xs text-red-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"whitespace-nowrap",children:"該服無平均價格且無最低價格，無法顯示價格"})]}):y?e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md bg-orange-900/50 border border-orange-500/40 text-xs text-orange-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-orange-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{className:"whitespace-nowrap",children:U||Q?"部分物品4天內無銷售記錄，無平均值改用該服最低價格":"最近四天沒有成功銷售記錄，無平均值和日均銷售，部分價格會使用該服最低價格"})]}):e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-md bg-blue-900/30 border border-blue-500/20 text-xs text-blue-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-blue-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"whitespace-nowrap",children:"價格為4天內該服賣出平均價格"})]}),N?Q?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-slate-800/60 border border-slate-600/40 text-xs w-fit self-end",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("span",{className:"text-gray-400",children:"日均銷量:"}),e.jsxs("span",{className:"text-emerald-300",title:"全服日均銷量",children:["全服 ",X.toFixed(1)]})]}):null:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-slate-800/60 border border-slate-600/40 text-xs w-fit self-end",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),e.jsx("span",{className:"text-gray-400",children:"日均銷量:"}),e.jsxs("span",{className:"text-cyan-300",title:"單服日均銷量",children:["單服 ",U?D.toFixed(1):"0.0"]}),Q&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-500",children:"/"}),e.jsxs("span",{className:"text-emerald-300",title:"全服日均銷量",children:["全服 ",X.toFixed(1)]})]})]})]})})(),v&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-ffxiv-gold"}),"載入價格中..."]})]})]}),$&&e.jsx("div",{className:"mb-4 p-2 bg-red-900/30 border border-red-500/30 rounded text-sm text-red-400",children:$}),e.jsx("div",{ref:j,className:`overflow-x-auto pb-2 relative ${W&&!A?"cursor-grab":""} ${A?"cursor-grabbing":""}`,onMouseDown:ne,onMouseLeave:()=>{A&&z(!1)},children:e.jsx("div",{className:"flex justify-center min-w-min py-2",children:e.jsx(re,{node:s,itemNames:c,itemPrices:m,queriedItemIds:b,onItemClick:O,isRoot:!0,isLoading:d,optimalPathMap:le,isCraftingCheaper:ee,isDcQuery:N})})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-purple-500/20 flex flex-wrap gap-4 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-ffxiv-gold/20 to-yellow-500/10 border border-ffxiv-gold/50"}),e.jsx("span",{children:"成品"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-slate-800/60 border border-purple-500/30"}),e.jsx("span",{children:"材料"})]}),ee&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-900/40 to-emerald-900/30 border-2 border-green-500/60"}),e.jsx("span",{className:"text-green-400",children:"最優路線(製作)"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gradient-to-br from-blue-900/40 to-cyan-900/30 border-2 border-blue-500/60"}),e.jsx("span",{className:"text-blue-400",children:"最優路線(購買)"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-green-400 font-semibold",children:"價格"}),e.jsxs("span",{children:["= NQ",N?"最低價":"平均價"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"px-1 py-0.5 text-[10px] font-bold text-ffxiv-gold border border-ffxiv-gold/50 rounded bg-ffxiv-gold/10 cursor-default",children:"HQ"}),e.jsx("span",{className:"text-yellow-400 font-semibold",children:"價格"}),e.jsxs("span",{children:["= HQ",N?"最低價":"平均價"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"= 複製名稱"})]})]})]}):e.jsx("div",{className:"p-4 text-center text-gray-400",children:"無製作配方"})}export{Ne as default};
